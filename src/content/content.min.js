moment.tz.setDefault("America/Los_Angeles");
var debugMode = false;
var chartContainers = {};
var logged_in_user = false;
var G_IS_PRO = false;
var G_LICENCE = false;
var G_LICENCE_MSG = "";
var G_TAX_RATE = 0;
var all_shirt_colours = {
    dark_heather: "Dark Heather",
    heather_grey: "Heather Grey",
    heather_blue: "Heather Blue",
    black: "Black",
    navy: "Navy",
    silver: "Silver",
    royal_blue: "Royal Blue",
    brown: "Brown",
    slate: "Slate",
    red: "Red",
    asphalt: "Asphalt",
    grass: "Grass",
    olive: "Olive",
    kelly_green: "Kelly Green",
    baby_blue: "Baby Blue",
    white: "White",
    lemon: "Lemon",
    cranberry: "Cranberry",
    pink: "Pink",
    orange: "Orange",
    purple: "Purple"
};

function showModal(b, a) {
    a = a || false;
    if (a) {
        $(b).modal(a)
    } else {
        $(b).modal()
    }
}

function autoReLogin(b, a) {
    function c() {
        onmessage = function (e) {
            var f = Math.floor(Math.random() * (2510 - 1501 + 1) + 1501);
            setTimeout(function () {
                postMessage("go")
            }, f)
        }
    }

    if (window != self) {
        c()
    }
    var d = new Worker(URL.createObjectURL(new Blob(["(" + c.toString() + ")()"], {type: "text/javascript"})));
    d.postMessage(0);
    chrome.extension.sendMessage({show_in_bg_log: "true", msg: moment().format("HH:mm:ss") + " Creating Timeout"});
    d.onmessage = function (e) {
        chrome.extension.sendMessage({show_in_bg_log: "true", msg: moment().format("HH:mm:ss") + " Running Timeout"});
        if (document.getElementById("ap_email")) {
            document.getElementById("ap_email").value = b
        } else {
            if (document.getElementById("ap-claim")) {
                document.getElementById("ap-claim").value = b;
                document.getElementById("ap-credential-autofill-hint").value = b;
                document.getElementById("ap-credential-autofill-hint").dataset.claim = b
            }
        }
        document.getElementById("ap_password").value = a;
        document.getElementById("signInSubmit").click()
    };
    d.onerror = function (e) {
        chrome.extension.sendMessage({show_in_bg_log: "true", msg: "Worker got en error " + e.data})
    }
}

function toggleLoaderDiv(b, c) {
    var a = '<div class="loader-container fade"><div class="pretty-spinner"></div></div>';
    var d = $(b).find(".loader-container").length > 0 ? true : false;
    if (c == "show") {
        if (!d) {
            $(b).prepend(a);
            setTimeout(function () {
                $(b).find(".loader-container").addClass("show")
            }, 100)
        }
    } else {
        if (d) {
            $(b).find(".loader-container").removeClass("show");
            setTimeout(function () {
                $(b).find(".loader-container").remove()
            }, 300)
        }
    }
}

function toggleProgressBar(a, c, e) {
    var b = '<div class="progress-container fade"><div class="progress-title">' + e + '</div><div class="progress" style="max-width: 440px; margin: 0 auto;"><div class="progress-bar" style="width: 0%; height: 15px; background-color:#5facff;"></div></div></div>';
    var d = $(a).find(".progress-container").length > 0 ? true : false;
    if (c == "show") {
        if (!d) {
            $(a).prepend(b);
            setTimeout(function () {
                $(a).find(".progress-container").addClass("show")
            }, 10)
        }
    } else {
        if (d) {
            setTimeout(function () {
                $(a).find(".progress-container").removeClass("show");
                setTimeout(function () {
                    $(a).find(".progress-container").remove()
                }, 300)
            }, 500)
        }
    }
}

function updateProgressBar(a, b) {
    var c = $(a).find(".progress-container").length > 0 ? true : false;
    if (c) {
        $(a).find(".progress-container .progress-bar").css("width", b + "%")
    }
}

function updatePublishedItemsSummary(a) {
    if (a.eligibilityStatus == "PUBLISH_DISABLED") {
        $(".daily-limit .progress-text.uploads").addClass("hidden");
        $(".daily-limit .progress-text.special-message").html("<i class='fa fa-snowflake-o'></i> Uploads temporarily disabled").removeClass("hidden")
    } else {
        if ($(".daily-limit .progress-text.uploads").hasClass("hidden")) {
            $(".daily-limit .progress-text.uploads").removeClass("hidden");
            $(".daily-limit .progress-text.special-message").addClass("hidden")
        }
    }
    $(".daily-limit").find(".progress-bar").css("width", a.numUploadedPercent + "%");
    $(".daily-limit .used").html(a.numUploaded);
    $(".daily-limit .limit").html(a.maxAllowedSubmissions);
    $(".total-limit").find(".progress-bar").css("width", a.publishedItemPercent + "%");
    $(".total-limit .used").html(a.publishedItemCount);
    $(".total-limit .limit").html(a.publishedItemCountLimit);
    $(".header-stats.tier .tier-text .number").html(a.publishedItemCountLimit);
    $(".header-stats.tier .tier-icon").css("background-image", "url(" + a.tier_img + ")");
    $(".header-stats.tier .tier-icon").attr("data-html", true).attr("data-original-title", "Merch Level:<br/><b>" + a.tier_name.toUpperCase() + "</b>").tooltip({
        delay: {
            show: 200,
            hide: 0
        }
    })
}

function updateProcessingItemsSummary(a) {
    if (a.total_auto_review > 0) {
        $(".header-stats.auto-review").addClass("active")
    } else {
        $(".header-stats.auto-review").removeClass("active")
    }
    $(".header-stats.auto-review .number").html(a.total_auto_review);
    if (a.total_processing > 0) {
        $(".header-stats.processing").addClass("active")
    } else {
        $(".header-stats.processing").removeClass("active")
    }
    $(".header-stats.processing .number").html(a.total_processing);
    if (a.total_manual_review > 0) {
        $(".header-stats.manual-review").addClass("active")
    } else {
        $(".header-stats.manual-review").removeClass("active")
    }
    $(".header-stats.manual-review .number").html(a.total_manual_review);
    if (a.total_rejected > 0) {
        $(".header-stats.rejected").addClass("active")
    } else {
        $(".header-stats.rejected").removeClass("active")
    }
    $(".header-stats.rejected .number").html(a.total_rejected)
}

function deductTax(c) {
    var a = G_TAX_RATE / 100;
    var b = c * (1 - a);
    return b.toFixed(2)
}

function royaltiesTitleText(a) {
    var b = "Royalties";
    if (G_TAX_RATE > 0) {
        b += "\n$" + deductTax(a) + " after " + G_TAX_RATE + "% tax"
    }
    return b
}

function royaltiesTaxClass() {
    return (G_TAX_RATE > 0 ? "royalties-with-tax" : "")
}

function royaltiesTaxIcon() {
    return (G_TAX_RATE > 0 ? '<span class="royalties-tax-icon" style="">*</span>' : "")
}

function formatRoyaltiesElement(a, b) {
    a.attr("title", royaltiesTitleText(b));
    if (G_TAX_RATE > 0) {
        if (!a.hasClass("royalties-with-tax")) {
            a.addClass(royaltiesTaxClass())
        }
        if (!a.find(".royalties-tax-icon").length) {
            a.append(royaltiesTaxIcon())
        }
    }
}

function updateSalesSummary(a) {
    $(a.result_container).find(".title .subtitle").html(a.title_date);
    $(a.result_container).find(".net-sales").html(a.net_sales);
    $(a.result_container).find(".total-sales").html(a.total_sales);
    $(a.result_container).find(".cancelled").html(a.total_cancelled);
    $(a.result_container).find(".returned").html(a.total_returned);
    $(a.result_container).find(".revenue .number").html(a.total_revenue);
    $(a.result_container).find(".royalties .number").html(parseFloat(a.total_royalties).toFixed(2));
    formatRoyaltiesElement($(a.result_container).find(".royalties"), a.total_royalties);
    toggleLoaderDiv(a.result_container, "hide")
}

function updateAllTimeSalesSummary(b) {
    var a = ".sales-summary.all-time";
    $(a).find(".net-sales").html(b.totalNetSold);
    $(a).find(".total-sales").html(b.totalSold);
    $(a).find(".cancelled").html(b.totalCancelled);
    $(a).find(".returned").html(b.totalReturned);
    $(a).find(".royalties .number").html(parseFloat(b.totalRoyalties).toFixed(2));
    formatRoyaltiesElement($(a).find(".royalties"), b.totalRoyalties);
    toggleLoaderDiv(a, "hide")
}

function createDetailedShirtList(g, h, b, o) {
    b = b || "";
    o = o || "template-small";
    if (g.length > 0) {
        var m = "";
        var n = "";
        var c = "https://www.amazon.com/dp/";
        var a = "";
        if (o == "template-small") {
            a = '<div class="pretty-scrollbar" style="height: 323px; overflow: hidden; overflow-y: auto;">' + b + '<table class="table table-sm shirts-list"><tbody>'
        } else {
            if (o == "template-full") {
                a = '<div class="" style=""><table class="table shirts-list template-full"><thead><tr><th scope="col">Sales</th><th scope="col">Returns</th><th scope="col">Royalties</th><th scope="col">Title</th><th scope="col">Product</th><th scope="col">Fit Type</th><th scope="col" colspan="2" style="position: relative">Color<div class="clearfix" style="position:absolute; right:0; bottom:10px; color:#a5a5a5; font-size:18px" title="Screenshot Mode: \nHides shirt titles so you can take a screenshot"><i class="fa fa-eye-slash" style="margin-right:5px; cursor: help" ></i><div class="switch-container float-right"><label for="blur_switch_2"><input type="checkbox" id="blur_switch_2" class="hide-titles" ' + ($("#blur_switch").is(":checked") ? "checked" : "") + '/><span class="switch"></span><span class="toggle"></span></label></div></div></th></tr></thead><tbody>'
            }
        }
        if ($("#blur_switch").is(":checked")) {
            m = "blur-contents"
        }
        for (i = 0; i < g.length; i++) {
            var l = {};
            var j = {};
            var e = 0;
            var k = "";
            if (g[i].variation_totals.color.length) {
                var d = g[i].variation_totals.color.sort(function (q, p) {
                    return p.total - q.total
                });
                for (x = 0; x < d.length; ++x) {
                    l[d[x].variation] = d[x].total
                }
            }
            if (l) {
                Object.keys(l).forEach(function (p) {
                    var q = p;
                    var r = all_shirt_colours[p];
                    k += '<div class="colour-circle ' + q + '" title="' + r + '">' + l[p] + "</div>"
                })
            }
            if (g[i].variation_totals.fitType.length) {
                for (x = 0; x < g[i].variation_totals.fitType.length; ++x) {
                    j[g[i].variation_totals.fitType[x].variation] = g[i].variation_totals.fitType[x].total
                }
            }
            if (j.unisex) {
                n = '<div class="shirt-stats ' + (j.unisex ? "enabled" : "") + '" title="Unisex"><div class="icon"><i class="fa fa-user"></i></div><div class="number">' + (j.unisex ? j.unisex : 0) + "</div></div>"
            } else {
                n = '<div class="shirt-stats ' + (j.men ? "enabled" : "") + '" title="Men"><div class="icon"><i class="fa fa-male"></i></div><div class="number">' + (j.men ? j.men : 0) + '</div></div><div class="shirt-stats ' + (j.women ? "enabled" : "") + '" title="Women"><div class="icon"><i class="fa fa-female"></i></div><div class="number">' + (j.women ? j.women : 0) + '</div></div><div class="shirt-stats ' + (j.youth ? "enabled" : "") + '" title="Youth" style="margin-right:0"><div class="icon"><i class="fa fa-child"></i></div><div class="number">' + (j.youth ? j.youth : 0) + "</div></div>"
            }
            if (o == "template-small") {
                var f = (h == ".todays-shirts-list" ? true : false);
                a += '<tr><td style="width:65px;" class="text-center num-sales"><div class="header-stats" style="padding: 0"><div class="number">' + (g[i].net_just_sold ? '<div class="latest-sale-circle" title="Latest sale"></div>' : "") + g[i].net_sold + '</div><div class="royalties ' + royaltiesTaxClass() + '" style="margin-top:3px" title="' + royaltiesTitleText(g[i].royaltyValue) + '">' + g[i].royaltySymbol + g[i].royaltyValue + royaltiesTaxIcon() + '</div></div></td><td style="" class=""><div class="hide-in-screenshot ' + m + '" style="line-height: 18px;"><a href="' + c + g[i].asin + '" target="_blank" title="' + g[i].asinName + '">' + g[i].asinName + '</a></div><div style="font-size: 10px; text-transform: uppercase; color: #a5a5a5; line-height: 10px; margin-top: 4px;">' + g[i].productType + "</div>" + (f && g[i].unitsReturned > 0 ? '<div style="font-size: 10px; text-transform: uppercase; color: orange; line-height: 10px; margin-top: 5px;">' + g[i].unitsReturned + " Returned</div>" : "") + '</td><td style="min-width: 145px"><div class="" style="padding-left:2px; white-space: nowrap;">' + n + '</div><div style="margin-top: 2px">' + k + '</div></td><td style="text-align: center"><a href="https://merch.amazon.com/merch-tshirt/title-setup/' + g[i].merchandiseId + '/add_details" class="btn btn-light btn-sm btn-icon" target="_blank" style="" title="Edit"><i class="fa fa-pencil" style=""></i></a></td></tr>'
            } else {
                if (o == "template-full") {
                    e = (g[i].royaltyValue > 0 ? g[i].royaltySymbol + parseFloat(g[i].royaltyValue / g[i].net_sold).toFixed(2) : "&nbsp;");
                    a += '<tr><td style="padding: 0" class="text-center"><div class="main-text" style="width: 70px; font-weight: 900">' + g[i].net_sold + '</div><div class="sub-text" style="" title="Sold - Cancelled">' + g[i].unitsSold + " - " + g[i].unitsCancelled + '</div></td><td style="" class="text-center"><div class="main-text" style="' + (g[i].unitsReturned > 0 ? "font-weight: bold" : "color: #d1d1d1") + '">' + g[i].unitsReturned + '</div><div class="sub-text">&nbsp;</div></td><td style="" class="text-center"><div class="main-text ' + royaltiesTaxClass() + '" style="font-weight: 600" title="' + royaltiesTitleText(g[i].royaltyValue) + '">' + g[i].royaltySymbol + g[i].royaltyValue + royaltiesTaxIcon() + '</div><div class="sub-text" style="" title="Avg. royalties per sale">' + e + '</div></td><td style="" class=""><div class="hide-in-screenshot ' + m + '" style=""><a href="' + c + g[i].asin + '" target="_blank" title="' + g[i].asinName + '">' + g[i].asinName + '</a></div><div class="sub-text hide-in-screenshot ' + m + '" style="" title="Product ASIN">' + g[i].asin + '</div></td><td style="" class="light-text">' + g[i].productType.replace(/-/gi, "&#8209;") + '</td><td style=""><div style="min-width: 125px; white-space: nowrap;">' + n + '</div></td><td style=""><div style="width: 140px">' + k + '</div></td><td style=""><a href="https://merch.amazon.com/merch-tshirt/title-setup/' + g[i].merchandiseId + '/add_details" class="btn btn-light btn-sm btn-icon" target="_blank" style="" title="Edit"><i class="fa fa-pencil" style=""></i></a></td></tr>'
                }
            }
        }
        a += "</tbody> </table> </div>"
    } else {
        if (o == "template-small") {
            var a = '<div style="height: 323px; position: relative;"><div class="no-sales-message" style="position: absolute; width: 100%; text-align: center; padding-top: 10px; z-index: 1"><div class="title" style="font-size: 20px; font-weight: 600; border:none;">No sales yet</div><div class="text" style="font-size: 14px; color: #656565;">Hang in there... We\'ll notify you<br/>the moment you make a sale!</div></div><div class="" style=""><img src="' + chrome.extension.getURL("/img/comeinframe.gif") + '" style="opacity: 0.3"></div></div>'
        } else {
            if (o == "template-full") {
                var a = '<div class="no-sales-message" style="text-align: center; margin: 15px 0;"><div class="title" style="font-size: 38px; font-weight: 600; color: #757575; line-height: 1">No sales</div><div class="text" style="font-size: 18px; color: #959595; line-height: 1.2; margin: 15px 0;">It looks like you didn\'t sell any products<br/>in the selected period</div><img src="' + chrome.extension.getURL("/img/no-sales-grin.png") + '" style="height: 200px; opactiy: 0.8;"></div>'
            }
        }
    }
    $(h).html(a)
}

function updatetopSellerSummary(d) {
    var b = [];
    var f = [];
    var a = d.result_container;
    var e = "https://www.amazon.com/dp/";
    if (typeof d.top_sellers != "undefined" && d.top_sellers != "") {
        b = d.top_sellers;
        var c = '<div class="info-small text-center">Shirts which sold the most units in the last 30 days</div>';
        createDetailedShirtList(b, a + " .top-sales-list", c)
    }
    if (typeof d.top_royalties != "undefined" && d.top_royalties != "") {
        f = d.top_royalties;
        var c = '<div class="info-small text-center">Shirts which made the most royalties in the last 30 days</div>';
        createDetailedShirtList(f, a + " .top-royalties-list", c)
    }
    toggleLoaderDiv(a, "hide")
}

function showSalesModal(d, a, b, e) {
    e = e || "#salesModal .shirt-list";
    $("#salesModal .modal-title").html("");
    $("#salesModal .chart-summary-container").addClass("hidden");
    $("#salesModal .shirt-list").html("");
    $("#salesModal .sales").html("0");
    $("#salesModal .sold-cancelled").html("0 - 0");
    $("#salesModal .returned").html("0");
    $("#salesModal .royalties .number").html("0");
    $("#salesModal .royalties .decimal").html("00");
    $("#salesModal .revenue").html("0");
    $("#salesModal .royalties-per-sale .number").html("0");
    $("#salesModal .royalties-per-sale .decimal").html("00");
    $("#salesModal .chart-summary-container .top-products").html("");
    $("#salesModal .chart-summary-container .top-fit-types").html("");
    $("#salesModal .chart-summary-container .top-colors").html("");
    showModal("#salesModal");
    var c = {get_sales_summary: true, period: d, startDate: a, endDate: b, target_container: e};
    chrome.extension.sendMessage(c, function (g) {
        $("#salesModal .modal-title").html("Sales: " + g.title_date, "");
        if (g.net_sales > 0 || g.total_returned > 0) {
            $("#salesModal .chart-summary-container").removeClass("hidden");
            $("#salesModal .sales").html(g.net_sales);
            $("#salesModal .sold-cancelled").html(g.total_sales + " - " + g.total_cancelled);
            $("#salesModal .returned").html(g.total_returned);
            $("#salesModal .royalties .number").html(Math.trunc(g.total_royalties));
            $("#salesModal .royalties .decimal").html((g.total_royalties % 1).toFixed(2).substring(1));
            formatRoyaltiesElement($("#salesModal .chart-summary-container .royalties"), g.total_royalties);
            $("#salesModal .revenue").html(parseFloat(g.total_revenue).toFixed(2));
            $("#salesModal .royalties-per-sale .number").html((g.net_sales > 0 ? Math.trunc(g.total_royalties / g.net_sales) : 0));
            $("#salesModal .royalties-per-sale .decimal").html((g.net_sales > 0 ? ((g.total_royalties / g.net_sales) % 1).toFixed(2).substring(1) : ".00"));
            if (g.variation_totals.productType) {
                var j = "";
                var l = g.variation_totals.productType.sort(function (o, n) {
                    return n.total - o.total
                });
                for (x = 0; x < l.length; ++x) {
                    j += '<div class="custom-progress yellow"><div class="text-line clearfix"><div class="text">' + l[x].variation.replace(/_/g, " ").toLowerCase() + '</div><div class="number">' + Math.round((l[x].total / g.net_sales) * 100) + '%<span class="light-number">(' + l[x].total + ')</span></div></div><div class="progress"><div class="progress-bar" style="width:' + (l[x].total / g.net_sales) * 100 + '%"></div></div></div>'
                }
                $("#salesModal .chart-summary-container .top-products").append(j)
            }
            if (g.variation_totals.fitType) {
                var j = "";
                var h = g.variation_totals.fitType.sort(function (o, n) {
                    return n.total - o.total
                });
                for (x = 0; x < h.length; ++x) {
                    j += '<div class="custom-progress blue"><div class="text-line clearfix"><div class="text">' + h[x].variation + '</div><div class="number">' + Math.round((h[x].total / g.net_sales) * 100) + '%<span class="light-number">(' + h[x].total + ')</span></div></div><div class="progress"><div class="progress-bar" style="width:' + (h[x].total / g.net_sales) * 100 + '%"></div></div></div>'
                }
                $("#salesModal .chart-summary-container .top-fit-types").append(j)
            }
            if (g.variation_totals.color) {
                var k = "";
                var f = g.variation_totals.color.sort(function (o, n) {
                    return n.total - o.total
                });
                for (x = 0; x < f.length; ++x) {
                    var m = all_shirt_colours[f[x].variation];
                    k += '<div class="colour-circle ' + f[x].variation + '" data-toggle="tooltip" title="' + m + '">' + f[x].total + "</div>"
                }
                $("#salesModal .chart-summary-container .top-colors").append(k)
            }
        } else {
        }
        createDetailedShirtList(g.products_list, e, "", "template-full");
        $("#salesModal").find('[data-toggle="tooltip"]').tooltip()
    })
}

function showSalesChartModal() {
    var e = {};
    var d = -1;
    var c = false;
    var b = 0;
    showModal("#chartModal");
    var a = {get_all_time_sales: true, progress_container: "#chartModal .modal-body"};
    chrome.extension.sendMessage(a, function (f) {
        $("#chartModal .modal-title").html("Sales: All Time");
        $("#chartModal .sales").html(f.totalNetSold);
        $("#chartModal .sold-cancelled").html(f.totalSold + " - " + f.totalCancelled);
        $("#chartModal .returned").html(f.totalReturned);
        $("#chartModal .royalties .number").html(Math.trunc(f.totalRoyalties));
        $("#chartModal .royalties .decimal").html((f.totalRoyalties % 1).toFixed(2).substring(1));
        formatRoyaltiesElement($("#chartModal .royalties"), f.totalRoyalties);
        $("#chartModal .revenue").html(f.totalRevenue.toFixed(2));
        var g = f.totalNetSold - f.totalReturned;
        $("#chartModal .royalties-per-sale .number").html((g > 0 ? Math.trunc(f.totalRoyalties / g) : 0));
        $("#chartModal .royalties-per-sale .decimal").html((g > 0 ? ((f.totalRoyalties / g) % 1).toFixed(2).substring(1) : ".00"));
        $("#chartModal .your-share").html((f.totalRoyalties > 0 ? ((f.totalRoyalties / f.totalRevenue) * 100).toFixed(0) : 0));
        $("#chartModal .amazons-share").html((f.totalRoyalties > 0 ? ((1 - (f.totalRoyalties / f.totalRevenue)) * 100).toFixed(0) : 0));
        e.result_container = "sales_chart";
        e.chart_labels = [];
        e.chart_data_sales = [];
        e.chart_data_royalties = [];
        for (x = 0; x < f.soldData.length; ++x) {
            if (f.soldData[x] > 0) {
                d = x;
                x = f.soldData.length
            }
        }
        if (d < 0 || (f.soldData.length - d) < 13) {
            d = f.soldData.length - 13
        } else {
            c = (f.soldData.length - d) * 73
        }
        for (x = 0; x < (f.soldData.length - d); ++x) {
            e.chart_labels[x] = f.datesData[d + x];
            e.chart_data_sales[x] = f.netSoldData[d + x];
            e.chart_data_royalties[x] = f.royaltiesData[d + x]
        }
        createChart(e);
        if (c) {
            $("#chartModal .chart_container").css("width", c);
            $("#chartModal .chart_outer_container").scrollLeft(c)
        }
    })
}

function createChart(e) {
    var k = (e.title_date ? e.title_date : "");
    var m = e.result_container;
    var j = e.chart_labels;
    var c = e.chart_data_sales;
    var g = e.chart_data_royalties;
    var h = [];
    var d = [];
    var a = [];
    var f = [];
    for (x = 0; x < (j.length); ++x) {
        if (x == j.length - 1) {
            h[x] = "rgba(201, 203, 207, 0.2)";
            d[x] = "rgb(201, 203, 207)";
            a[x] = "rgba(244, 245, 245, 1)";
            f[x] = "rgb(201, 203, 207)"
        } else {
            h[x] = "rgba(54, 162, 235, 0.2)";
            d[x] = "rgb(54, 162, 235)";
            a[x] = "rgba(255, 224, 230, 1)";
            f[x] = "rgba(255,99,132,1)"
        }
    }
    if (k != "") {
        $("." + e.result_container).find(".title .subtitle").html(e.title_date)
    }
    var b = $("#" + m).data("display");
    var l = document.getElementById(m).getContext("2d");
    chartContainers[m] = new Chart(l, {
        type: "bar",
        data: {
            labels: j,
            datasets: [{
                hidden: !G_IS_PRO,
                label: "Royalties",
                data: g,
                yAxisID: "y-axis-r",
                type: "line",
                fill: false,
                showLine: true,
                lineTension: 0,
                borderColor: f,
                borderWidth: 1,
                pointBackgroundColor: a,
                pointBorderColor: f,
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 4
            }, {label: "Sold", data: c, yAxisID: "y-axis-l", backgroundColor: h, borderColor: d, borderWidth: 1}]
        },
        options: {
            maintainAspectRatio: false,
            animation: {duration: 0},
            scales: {
                yAxes: [{
                    id: "y-axis-l",
                    position: "left",
                    gridLines: {zeroLineColor: "rgba(201, 203, 207, 1)", color: "rgba(201, 203, 207, 0.4)"},
                    ticks: {
                        beginAtZero: true, callback: function (n) {
                            if (n % 1 === 0) {
                                return n
                            }
                        }
                    }
                }, {
                    display: G_IS_PRO,
                    id: "y-axis-r",
                    position: "right",
                    gridLines: {display: false, color: "rgba(201, 203, 207, 1)"},
                    ticks: {
                        beginAtZero: true, callback: function (n) {
                            if (n % 1 === 0) {
                                return "$" + n
                            }
                        }
                    }
                }],
                xAxes: [{
                    gridLines: {zeroLineColor: "rgba(201, 203, 207, 1)", color: "transparent"},
                    ticks: {
                        beginAtZero: true, callback: function (q, o, n) {
                            var p = "";
                            if (b == "daily") {
                                p = moment(q).format("ddd") + ", " + moment(q).format("M/D")
                            } else {
                                if (b == "monthly") {
                                    p = moment(q).format("MMM") + " " + moment(q).format("YY")
                                }
                            }
                            return p
                        }
                    }
                }]
            },
            legend: {display: false,},
            tooltips: {
                enabled: G_IS_PRO,
                intersect: false,
                mode: "index",
                positon: "average",
                itemSort: function (o, n) {
                    return n.datasetIndex - o.datasetIndex
                },
                callbacks: {
                    label: function (p, q) {
                        var n = q.datasets[p.datasetIndex]["label"];
                        var o = q.datasets[p.datasetIndex]["data"][p.index];
                        if (p.datasetIndex == 0) {
                            o = "$" + parseFloat(o).toFixed(2)
                        }
                        return n + ": " + o
                    }
                },
                backgroundColor: "#fdfdfd",
                borderColor: "#d1d1d1",
                borderWidth: 1,
                titleFontSize: 12,
                titleMarginBottom: 12,
                titleFontColor: "#333",
                bodyFontColor: "#333",
                bodyFontSize: 14,
                bodySpacing: 8
            },
            hover: {
                intersect: false, onHover: function (p, o) {
                    var n = this.getElementAtEvent(p);
                    $("#" + p.srcElement.id).css("cursor", n[0] ? "pointer" : "default")
                }
            },
            onClick: function (t, r) {
                if (G_IS_PRO) {
                    var p = G_IS_PRO ? 1 : 0;
                    var q = r;
                    var u = this.getElementAtEvent(t);
                    if (u.length > 0) {
                        var n = u[0]._chart.canvas.dataset.display;
                        var v = q[p]._model.label;
                        var s = 0;
                        var o = 0;
                        if (n == "daily") {
                            s = moment(v).startOf("day").valueOf();
                            o = moment(v).startOf("day").valueOf()
                        } else {
                            if (n == "monthly") {
                                s = moment(v).startOf("month").valueOf();
                                o = moment(v).endOf("month").startOf("day").valueOf()
                            }
                        }
                        showSalesModal("custom", s, o)
                    } else {
                    }
                } else {
                    showAvailableInProMessage("chart_click")
                }
            }
        }
    })
}

function updateSalesChart(c) {
    var d = c.data.net_sales;
    var b = c.data.total_royalties;
    var a = chartContainers[c.result_container];
    if (a) {
        a.options.animation.duration = 750;
        a.data.datasets[1].data[a.data.datasets[1].data.length - 1] = d;
        a.data.datasets[0].data[a.data.datasets[0].data.length - 1] = b;
        a.update()
    }
}

function showLatestAmzMessage(a) {
    $("#amzMessageModal .message").html("<div style='color:#aaaaaa; margin-bottom:5px'>DATE: <b>" + a.date + "</b></div><p>" + a.msg + "</p>");
    $("#amzMessageModal .message").append('<a href="https://merch.amazon.com/dashboard?oldDash">View all messages on dashboard</a>');
    showModal("#amzMessageModal")
}

function showLatestEarnings(a) {
    $("#earningsModal .earnings-date").html(a.date);
    $("#earningsModal .earnings-currency").html(a.earnings.currencySymbol);
    $("#earningsModal .earnings-int").html(Math.trunc(a.earnings.earningsBeforeTaxValue));
    $("#earningsModal .earnings-dec").html((a.earnings.earningsBeforeTaxValue % 1).toFixed(2).substring(1));
    if (G_TAX_RATE > 0) {
        $("#earningsModal .earnings-after-tax-container").removeClass("hidden");
        $("#earningsModal .earnings-after-tax").html(deductTax(a.earnings.earningsBeforeTaxValue));
        $("#earningsModal .tax-rate").html(G_TAX_RATE)
    }
    showModal("#earningsModal")
}

function showTierUpModal(a) {
    $("#tierUpModal .tier_img").attr("src", a.tier_img);
    $("#tierUpModal .tier_num").html(a.tier);
    $("#tierUpModal .tier_name").html(a.tier_name);
    showModal("#tierUpModal");
    $("#tierUpModal").off("shown.bs.modal").on("shown.bs.modal", function (b) {
        confetti("confetti-canvas", "start")
    });
    $("#tierUpModal").off("hide.bs.modal").on("hide.bs.modal", function (b) {
        confetti("confetti-canvas", "stop")
    })
}

function showAvailableInProMessage(c) {
    var a = [];
    var b = "";
    $("#availableInProModal .list").html("");
    $("#availableInProModal .feature_img").attr("src", "");
    b = "pm-pro-preview.png";
    $("#availableInProModal .feature_img").attr("src", chrome.extension.getURL("/img/" + b));
    showModal("#availableInProModal")
}

chrome.runtime.onMessage.addListener(function (d, c, a) {
    if (d.update) {
        if (d.update == "publishedItemsSummary") {
            updatePublishedItemsSummary(d.data)
        }
        if (d.update == "processingItemsSummary") {
            updateProcessingItemsSummary(d.data)
        }
        if (d.update == "salesSummary") {
            updateSalesSummary(d.data)
        }
        if (d.update == "allTimeSalesSummary") {
            updateAllTimeSalesSummary(d.data)
        }
        if (d.update == "createChart") {
            createChart(d.data)
        }
        if (d.update == "updateSalesChart") {
            updateSalesChart(d.data)
        }
        if (d.update == "topSellerSummary") {
            updatetopSellerSummary(d.data)
        }
        if (d.update == "todaysSalesList") {
            createDetailedShirtList(d.data, ".todays-shirts-list")
        }
        if (d.update == "showAmzMessage") {
            showLatestAmzMessage(d.data)
        }
        if (d.update == "showLatestEarnings") {
            showLatestEarnings(d.data)
        }
        if (d.update == "showTierUpModal") {
            showTierUpModal(d.data)
        }
        if (d.update == "loggedOut") {
            var b = {backdrop: "static", keyboard: false};
            showModal("#loggedOutModal", b)
        }
    }
    if (d.toggleLoaderDiv) {
        toggleLoaderDiv(d.container, d.action)
    }
    if (d.toggleProgressBar) {
        toggleProgressBar(d.container, d.action, d.title)
    }
    if (d.updateProgressBar) {
        updateProgressBar(d.container, d.percentComplete)
    }
    if (d.authentication) {
        showDashContents(d)
    }
    if (d.attempt_auto_login) {
        autoReLogin(d.email, d.password)
    }
    if (d.reloadTabs) {
        window.location.reload(true)
    }
});
$(document).ready(function () {
    var f = chrome.runtime.getManifest();
    var b = $(".a-row.top-nav-links-container > ul");
    var a = $(".a-row.top-nav-links-container > ul > li:first");
    var c = $().add('<li class="a-align-center top-nav-link-unselected"><span class="a-list-item"><a class="a-link-normal" href="/dashboard?prettyDash">PrettyMerch</a></span></li>');
    var d = window.location.href;
    if (d.indexOf("signin") != -1 && d.indexOf("merch.amazon.com") != -1) {
        $("#signInSubmit").click(function () {
            var h = "tmp";
            if (document.getElementById("ap_email")) {
                h = btoa(document.getElementById("ap_email").value)
            } else {
                if (document.getElementById("ap-claim")) {
                    h = btoa(document.getElementById("ap-claim").value)
                }
            }
            chrome.extension.sendMessage({user_logged_in: "true", s_id: h}, function (j) {
            })
        })
    } else {
        if (d.indexOf("dashboard") != -1 && d.indexOf("oldDash") == -1) {
            $("#app").addClass("hidden");
            var e = '<div id="prettydash-wrapper" style="position:relative"><div id="prettydash-container" class="container"></div></div>';
            $().add(e).insertAfter(".top-nav-bar-container");
            a.removeClass("top-nav-link-selected").addClass("top-nav-link-unselected").find("a").first().prop("href", "/dashboard?oldDash");
            c.removeClass("top-nav-link-unselected").addClass("top-nav-link-selected").insertBefore(a);
            b.css("display", "block");
            chrome.extension.sendMessage({get_logged_in_user: true}, function (j) {
                logged_in_user = j;
                var h = logged_in_user + "_options";
                var k = logged_in_user + btoa("_licence");
                chrome.storage.sync.get([h, k, "welcomeMessage", "updateAvailableMessage", "updateMessage"], function (v) {
                    if (typeof v[h] != "undefined" && v[h] != "") {
                        if (v[h].tax_rate) {
                            G_TAX_RATE = v[h].tax_rate
                        }
                    } else {
                    }
                    if (typeof v[k] != "undefined" && v[k] != "") {
                        var G = atob(v[k].ul);
                        var R = atob(v[k].iv);
                        var l = atob(v[k].lm);
                        G_IS_PRO = (R === "true" ? true : false);
                        G_LICENCE = G;
                        G_LICENCE_MSG = l
                    } else {
                        G_IS_PRO = false;
                        G_LICENCE = false
                    }
                    var M = G_IS_PRO ? '<div class="badge badge-primary pro-badge" style="background-color: #f96e5f; font-size: 8px; position: absolute; top: 3px; right: -26px;">PRO</div>' : "";
                    var N = '<div class="modal fade" id="loggedOutModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body text-center clearfix"><div style="margin-bottom:10px"><img src="' + chrome.extension.getURL("/img/pretty-logo-logged-out.png") + '" width="" height="110px"></div><p class="h5">You\'ve been signed out</p><p class="h6">Heads up! It looks like you\'ve been signed out of your Merch by Amazon account. Sign in to continue getting realtime updates on your sales</p></div><div class="modal-footer"><a href="https://merch.amazon.com/dashboard" class="btn btn-primary" style="margin: 0 auto;">Go to sign-in page</a></div></div></div></div>';
                    var r = '<div class="modal fade" id="licenceModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><span class="modal-title">Upgrade to PrettyMerch Pro</span><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body clearfix"><form id="enterLicenceForm" style="margin: 5px 0 30px 0; padding: 10px 13px; border: 1px solid #9acff4; border-radius: 4px; background-color: #f4fbff;"><fieldset><div class="form-group" style="position: relative; margin-bottom: 20px;"><span class="form-control-label" for="licenceKey">Enter your licence key</span><input class="form-control form-control-lg licenceKey" style="padding: 8px 8px; font-weight: bold;" spellcheck="false" data-lpignore="true"><div class="invalid-feedback" style="position: absolute;">Invalid licence key</div></div></fieldset></form><div style="color: #555555"><p><b>How do I upgrade to PrettyMerch Pro?</b><br/>Simply enter your licence key above and click Save Licence. PrettyMerch will automatically be upgraded to the Pro version.</p><p><b>Where can I get a Licence Key?</b><br/>You can <a href="http://www.prettymerch.com/r/subscribe" target="_blank" title="Go to gumroad.com">purchase a licence from our page on Gumroad.com</a>.</p><p><b>Refund Policy</b><br/>If for any reason you want to cancel your subscription, we will refund your last payment, no questions asked. You will still be able to use the free version of PrettyMerch.</p></div></div><div class="modal-footer clearfix" style="display: block"><div class="float-left"><a href="http://www.prettymerch.com/r/subscribe" target="_blank" class="btn btn-link float-left purchaseLicence" style="padding-left:0px;" data-toggle="tooltip" data-placement="top" data-html="true" title="Click here to purchase a licence for PrettyMerch">Purchase a licence</a></div><button type="button" class="btn btn-light float-right" data-dismiss="modal">Close</button><button type="button" class="btn btn-primary float-right saveLicence">Save Licence</button></div></div></div></div>';
                    var Q = '<div id="invalidLicenceMessage" class="row hidden"><div class="col-12"><div class="alert alert-danger clearfix" style=""><div class="float-left" style="width: 60px"><i class="fa fa-exclamation-circle" style="width: 45px; height: auto; font-size: 45px; color: #dc3545"></i></div><div class="float-left" style="width: 100%; padding-left: 60px; margin-left: -60px;"><div class="title"></div><div class="message"></div><div style="margin-top:20px"><button type="button" class="btn btn-sm btn-primary enter-licence" style="margin-right: 6px">Update Licence Key</button><button type="button" class="btn btn-sm btn-light delete-licence" data-dismiss="alert">Got it, close this</button></div></div></div></div></div>';
                    var F = '<div id="updatesAvailableAlert" class="row hidden"><div class="col-12"><div class="alert alert-warning"><div class="title"></div><div class="message"></div><div style="margin-top:20px"><button type="button" class="btn btn-sm btn-warning update-extension-now" >Update PrettyMerch Now</button><button type="button" class="btn btn-sm btn-link clear-update-available" data-dismiss="alert">Not now, close this</button></div></div></div></div>';
                    var t = '<div id="welcomeMessage" class="row hidden"><div class="col-12"><div class="alert alert-primary clearfix" style="background-color: #e2effd;"><div class="float-left" style="width: 60px"><img src="' + chrome.extension.getURL("/img/announcement.png") + '" style="width: 45px; height: auto; margin-top: 5px"></div><div class="float-left" style="width: 100%; padding-left: 60px; margin-left: -60px;"><div class="title"></div><div class="message"></div><button type="button" class="btn btn-sm btn-primary clear-welcome-message" data-dismiss="alert" style="margin-top:20px">Got it, close this</button></div></div></div></div>';
                    var y = '<div id="updatesAlert" class="row hidden"><div class="col-12"><div class="alert alert-primary clearfix" style="background-color: #e2effd;"><div class="float-left" style="width: 60px"><img src="' + chrome.extension.getURL("/img/announcement.png") + '" style="width: 45px; height: auto; margin-top: 5px"></div><div class="float-left" style="width: 100%; padding-left: 60px; margin-left: -60px;"><div class="title"></div><div class="message"></div><div class="list"></div><button type="button" class="btn btn-sm btn-primary clear-update" data-dismiss="alert" style="margin-top:20px">Got it, close this</button></div></div></div></div>';
                    var u = '<div class="modal fade" id="updateProgressModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body text-center clearfix"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="75px" height="75px" class="" style="margin-bottom: 10px;"><p class="h5" style="margin-bottom:10px;">Updating PrettyMerch</p><div class="progress" style="margin-bottom: 5px"><div class="progress-bar" role="progressbar" style="width: 0%; height: 25px; background-color:#5facff;"></div></div><div class="progress-text">This will only take a few seconds</div><a href="https://merch.amazon.com/dashboard" class="btn btn-primary reload-page fade" style="margin: 0 auto; margin-top: 25px">Reload Page</a></div></div></div></div>';
                    var w = '<div class="modal fade" id="availableInProModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-body text-center clearfix" style=""><div style="font-size: 20px; line-height: 40px; margin-bottom: 20px"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="40px" height="40px" style="margin-right: 8px; "><span style="color:#f55d4c; margin-right:1px">Pretty</span><span style="color:#757575">Merch</span><span class="badge badge-primary" style="background-color: #f96e5f; margin-left: 6px; font-size: 12px; position: relative; top: -3px;">PRO</span></div><div class="" style="margin-bottom: 20px; font-size: 18px; line-height: 24px; color: #656565;">Upgrade to PrettyMerch PRO to unlock<br/>these awesome features</div><a style="display: block; margin-bottom: 25px" href="http://www.prettymerch.com/about-pro" target="_blank" title="Learn more about PrettyMerch Pro"><img class="feature_img" style="width: 450px; border: 1px solid #e1e1e1; border-radius: 8px; box-shadow: 4px 4px 8px rgba(1, 1, 1, 0.1);" src="" /></a><a href="http://prettymerch.com/r/subscribe" target="_blank" class="btn btn-success mr-2">Upgrade to PrettyMerch Pro</a><a href="http://prettymerch.com/about-pro" target="_blank" class="btn btn-light">Learn More</a></div><div class="modal-footer clearfix"><button type="button" class="btn btn-light" data-dismiss="modal">Close</button></div></div></div></div>';
                    var E = '<div class="modal fade" id="amzMessageModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><span class="modal-title">New message from Merch by Amazon</span><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button></div><div class="modal-body clearfix" style=""><div style="text-align:center; margin-bottom:10px"><img src="' + chrome.extension.getURL("/img/envelope.png") + '" width="" height="100px" style=""></div><div class="message" style="margin-bottom: 15px; font-size: 16px; line-height: 20px;"></div></div><div class="modal-footer clearfix" style="display: block"><div class="float-left" style="position: relative; margin-top: 6px;"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="18px" height="18px" style="margin-right: 5px;"><span style="color:#f55d4c; margin-right:1px">Pretty</span><span style="color:#757575">Merch</span>' + M + '</div><button type="button" class="btn btn-sm btn-light float-right" data-dismiss="modal">Close</button></div></div></div></div>';
                    var I = '<div class="modal fade" id="earningsModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><span class="modal-title">Earnings have been posted for <span class="earnings-date"></span></span><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button></div><div class="modal-body clearfix"><div class="clearfix" style="margin:40px 0 40px"><div class="text-center float-left" style="width: 150px"><img src="' + chrome.extension.getURL("/img/payout.png") + '" height="140px" class="tier_img"></div><div class="float-left" style="width: 100%; padding-left: 160px; margin-left: -150px;"><div style="font-size: 16px;">EST. EARNINGS BEFORE TAX</div><div style="margin: 10px 0 15px; font-size: 70px; line-height: 1"><span style="font-size: 45px;" class="earnings-currency"></span><span class="earnings-int"></span><span style="font-size: 45px;" class="earnings-dec"></span></div><div class="earnings-after-tax-container hidden" style="font-size: 16px; color: #959595"><span class="earnings-currency"></span><span class="earnings-after-tax"></span> AFTER <span class="tax-rate"></span>% TAX</div></div></div></div><div class="modal-footer clearfix" style="display:block"><div class="float-left" style="position: relative; margin-top: 6px;"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="18px" height="18px" style="margin-right: 5px;"><span style="color:#f55d4c; margin-right:1px">Pretty</span><span style="color:#757575">Merch</span>' + M + '</div><button type="button" class="btn btn-sm btn-light float-right" data-dismiss="modal">Close</button></div></div></div></div>';
                    var p = '<div class="modal fade" id="tierUpModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body text-center clearfix"><canvas id="confetti-canvas" ></canvas><div style="margin-top:10px; font-size: 20px; line-height: 20px;">Congratulations, you\'ve been Tiered Up</div><div class="clearfix" style="margin:50px 0 40px"><div class="float-left" style="width: 150px"><img src="' + chrome.extension.getURL("/img/tier10.png") + '" height="140px" class="tier_img"></div><div class="float-left" style="width: 100%; padding-left: 150px; margin-left: -150px;"><div style="font-size: 16px; font-weight:600">TIER</div><div class="tier_num" style="margin-bottom: 4px; font-size: 100px; line-height: 98px">99999</div><div style="font-size: 16px; color: #b1b1b1">MERCH LEVEL: <span class="tier_name" style="font-weight: 600; text-transform: uppercase">Ooops!</span></div></div></div><div style="margin-bottom: 10px; font-size: 16px; line-height: 20px;">Amazing work! Keep it up</div></div><div class="modal-footer clearfix" style="display:block"><div class="float-left" style="position: relative; margin-top: 6px;"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="18px" height="18px" style="margin-right: 5px;"><span style="color:#f55d4c; margin-right:1px">Pretty</span><span style="color:#757575">Merch</span>' + M + '</div><button type="button" class="btn btn-sm btn-light float-right close-tier-up-modal" data-dismiss="modal">Close</button></div></div></div></div>';
                    var H = '<div class="modal fade" id="salesModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><span class="modal-title">Sales:</span><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body clearfix" style="min-height: 300px;"><div class="row chart-summary-container" style=""><div class="col"><div class="row"><div class="col"><div class="clearfix" style="margin-bottom:30px;"><div class="chart-summary blue-container"><div class="chart-summary-title">Sales</div><div class="chart-summary-number"><span class="sales">0</span></div><div class="chart-summary-footer sold-cancelled" title="Sold - Cancelled">0 - 0</div></div><div class="chart-summary orange-container"><div class="chart-summary-title">Returns</div><div class="chart-summary-number returned">0</div></div><div class="chart-summary pink-container"><div class="chart-summary-title">Royalties</div><div class="chart-summary-number royalties"><span class="currency-symbol">$</span><span class="number">0</span><span class="decimal"></span></div><div class="chart-summary-footer" title="Total Revenue"><span class="currency-symbol">$</span><span class="revenue">0</span></div></div><div class="chart-summary" style=""><div class="chart-summary-title">Royalties/Sale</div><div class="chart-summary-number royalties-per-sale"><span class="currency-symbol">$</span><span class="number">0</span><span class="decimal"></span></div></div><div class="chart-summary" style="float:right; margin-right:0; display:none"><div class="chart-summary-title text-center">Avg. Per Day</div><div class="chart-summary-number clearfix"><div class="" style="float: left; box-sizing: border-box; text-align: center; width: 120px;"><span class="your-share">0</span></div><div class="" style="float: left; box-sizing: border-box; text-align: center; width: 120px"><span class="amazons-share">0</span></div></div><div class="chart-summary-footer clearfix"><div class="" style="float: left; box-sizing: border-box; text-align: center; width: 120px;">Sales</div><div class="" style="float: left; box-sizing: border-box; text-align: center; width: 120px">Royalties</div></div></div></div></div></div><div class="row"><div class="col" style=""><div class="stats-progress-col clearfix" style="padding-right: 6px"><div class="chart-summary-title">Top Products</div><div class="top-products"></div></div></div><div class="col" style=""><div class="stats-progress-col clearfix" style="padding: 0 3px"><div class="chart-summary-title">Top Fit Types</div><div class="top-fit-types"></div></div></div><div class="col"><div class="stats-progress-col clearfix" style="padding-left: 6px"><div class="chart-summary-title">Top Colors</div><div class="top-colors"></div></div></div></div></div></div><div class="shirt-list" style="min-height:100px"></div></div><div class="modal-footer clearfix" style="display:block"><div class="float-left" style="position: relative; margin-top: 6px;"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="18px" height="18px" style="margin-right: 5px;"><span style="color:#f55d4c; margin-right:1px">Pretty</span><span style="color:#757575">Merch</span>' + M + '</div><button type="button" class="btn btn-sm btn-light float-right" data-dismiss="modal">Close</button></div></div></div></div>';
                    var m = '<div class="modal fade" id="chartModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><span class="modal-title">Sales:</span><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body clearfix" style=""><div class="row chart-summary-container"><div class="col clearfix"><div class="chart-summary blue-container"><div class="chart-summary-title">Sales</div><div class="chart-summary-number"><span class="sales">0</span></div><div class="chart-summary-footer sold-cancelled" title="Sold - Cancelled">0 - 0</div></div><div class="chart-summary orange-container"><div class="chart-summary-title">Returns</div><div class="chart-summary-number returned">0</div></div><div class="chart-summary pink-container"><div class="chart-summary-title">Royalties</div><div class="chart-summary-number royalties"><span class="currency-symbol">$</span><span class="number">0</span><span class="decimal"></span></div><div class="chart-summary-footer" title="Total Revenue"><span class="currency-symbol">$</span><span class="revenue">0</span></div></div><div class="chart-summary"><div class="chart-summary-title">Royalties/Sale</div><div class="chart-summary-number royalties-per-sale"><span class="currency-symbol">$</span><span class="number">0</span><span class="decimal"></span></div></div><div class="chart-summary" style="float:right; margin-right:0"><div class="chart-summary-title text-center">Revenue Share</div><div class="chart-summary-number clearfix"><div class="" style="float: left; box-sizing: border-box; text-align: center; width: 120px;"><span class="your-share">0</span><span class="currency-symbol">%</span></div><div class="" style="float: left; box-sizing: border-box; text-align: center; width: 120px"><span class="amazons-share">0</span><span class="currency-symbol">%</span></div></div><div class="chart-summary-footer clearfix"><div class="" style="float: left; box-sizing: border-box; text-align: center; width: 120px;">You</div><div class="" style="float: left; box-sizing: border-box; text-align: center; width: 120px">Amazon</div></div></div></div></div><div class="chart_outer_container" style="position: relative; width: 968px; height: 475px; overflow-x: auto;"><div class="chart_container" style="position: relative; width: 100%; height: 100%;"><canvas id="sales_chart" data-display="monthly"></canvas></div></div></div></div></div></div>';
                    var q = '<div class="modal fade" id="optionsModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><span class="modal-title">PrettyMerch Options</span><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button></div><div class="modal-body options-form clearfix" style=""><div class="form-group" style="margin-bottom:25px"><label class="form-control-label">New Sales Notification</label><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" id="salesNotif">Show a notification when I make a sale</label></div><div class="saleSound-options" style="padding-left:20px; margin-top: 3px"><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="saleSound" value="coin-1"><span class="play_sound" title="Play sound"><i class="fa fa-play"></i></span> 8-bit Super Mario Coin</label></div><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="saleSound" value="cha-ching-1"><span class="play_sound" title="Play sound"><i class="fa fa-play"></i></span> Cha-Ching!</label></div><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="saleSound" value="no_sound">No sound</label></div></div></div><div class="form-group" style="margin-bottom:25px"><label class="form-control-label">Logged Out Notification</label><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" id="logoutNotif">Show a notification when I\'m logged out of Merch</label></div><div class="logoutSound-options" style="padding-left:20px; margin-top: 3px"><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="logoutSound" value="attention-5"><span class="play_sound" title="Play sound"><i class="fa fa-play"></i></span> Attention - Classic</label></div><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="logoutSound" value="attention-6"><span class="play_sound" title="Play sound"><i class="fa fa-play"></i></span> Attention - Subtle</label></div><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="logoutSound" value="no_sound">No sound</label></div></div></div><div class="form-group" style="margin-bottom:25px"><label class="form-control-label">Tax Deductions<small class="form-text text-muted">The selected tax rate will be deducted from all royalties</small></label><div class="form-row" style="padding-left: 20px"><label for="input_taxRate" class="col-2 col-form-label">Tax Rate</label><div class="col-10"><div class="input-group"><input type="text" class="form-control text-center col-3" id="input_taxRate" data-lpignore="true"><div class="input-group-append"><span class="input-group-text" id="">%</span></div><div class="invalid-feedback">Please enter a number between 0 and 100</div></div></div></div></div><div class="divider-title"><div><span class="badge badge-primary pro-badge" style="background-color: #f96e5f; margin-right: 4px; font-size: 12px; position: relative; top: 0px;">PRO</span>OPTIONS</div></div><div class="pro-options beta-options">' + (!G_IS_PRO ? '<div class="alert alert-primary text-center" style="font-size: 14px"><a href="http://prettymerch.com/r/subscribe" target="_blank" class="alert-link">Upgrade to PrettyMerch Pro</a> to unlock these awesome options</div>' : "") + '<div class="form-group"><label class="form-control-label">Auto Re-Login<small class="form-text text-muted">PrettyMerch will keep you logged in to your Merch by Amazon account</small></label><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" id="allow_autoReLogin">Keep me logged in to my Merch by Amazon account</label></div><div class="autoReLogin-options" style="padding-left: 40px"><div class="form-row" style="margin-top: 8px"><label for="input_arl_email" class="col-2 col-form-label">Email</label><div class="col-10"><input type="email" class="form-control col-10" id="input_arl_email" spellcheck="false" autocomplete="false" data-lpignore="true"><div class="invalid-feedback">Please enter a valid email</div></div></div><div class="form-row" style="margin-top: 8px"><label for="input_arl_password" class="col-2 col-form-label">Password</label><div class="col-10"><input type="password" class="form-control col-10" id="input_arl_password" spellcheck="false" autocomplete="false" data-lpignore="true"><div class="invalid-feedback">Please enter a valid password</div><small id="emailHelp" class="form-text text-muted"><a href="#" data-toggle="popover" data-placement="top" data-trigger="focus" title="Where are my credentials stored?" data-html="true" data-content="<p>Your email and password are <b>encrypted</b> and stored on <b>YOUR computer</b>.</p><p>They are used to re-log you into your Merch by Amazon account whenever you are logged out.</p><p>Your credentials are NOT transferred to any external services or servers.</p>">Where are my email and password stored?</a></small></div></div></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" id="saveOptions">Save and Close</button><button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button></div></div></div></div>';
                    var A = '<div class="prettydash-footer clearfix"><div class="float-left"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="18px" height="18px" style="margin-right: 5px; "><span style="color:#f55d4c; margin-right:1px">Pretty</span><span style="color:#757575">Merch</span><span class="version" style="margin-left: 8px; color: #959595;">v' + f.version + '</span></div><div class="float-right">' + (G_IS_PRO ? '<a href="" class="enter-licence" style="margin-right: 30px;"><i class="fa fa-pencil"></i> Edit Licence</a>' : '<a href="" class="enter-licence" title="Upgrade to PrettyMerch Pro" style="margin-right: 30px;"><i class="fa fa-unlock"></i> Upgrade to PRO</a>') + '<a href="http://www.prettymerch.com/r/android" target="_blank" title="Get the PrettyMerch App for Android" style="margin-right: 10px;"><i class="fa fa-android"></i> Android</a><a href="http://www.prettymerch.com/r/ios" target="_blank" title="Get the PrettyMerch App for iOS" style="margin-right: 30px;"><i class="fa fa-apple"></i> iOS</a><a href="http://www.prettymerch.com/r/facebook" target="_blank" title="Like PrettyMerch on Facebook" style="margin-right: 10px;"><i class="fa fa-facebook-square"></i> Facebook</a><a href="mailto: getprettymerch@gmail.com" title="Drop us a line" style="margin-right: 30px;"><i class="fa fa-envelope-o"></i> getprettymerch@gmail.com</a><a href="" class="trigger-options-modal" style="font-weight: 600"><i class="fa fa-cog"></i> Options</a></div></div>';
                    var L = moment().startOf("day").valueOf();
                    var P = "pretty-logo.png";
                    var D = "Pretty";
                    var C = "Merch";
                    var J = G_IS_PRO ? '<span class="badge badge-primary pro-badge" style="background-color: #f96e5f; margin-left: 6px; font-size: 12px; position: relative; top: -3px;">PRO</span>' : "";
                    var O = G_IS_PRO ? "" : '<div class="badge badge-primary pro-badge" style="background-color: #f96e5f; font-size: 8px; position: absolute;">PRO</div>';
                    var K = '<div id="prettydash" class="prettydash row" style="padding-top: 20px;"><div class="col-12">' + t + Q + F + y + '<div class="row" style="margin-bottom: 20px"><div class="col-4"><div class="header"><img src="' + chrome.extension.getURL("/img/" + P) + '" width="40px" height="40px" style="margin-right: 8px; "><span style="color:#f55d4c; margin-right:1px">' + D + '</span><span style="color:#757575">' + C + "</span>" + J + '</div></div><div class="col-8 clearfix"><a href="https://merch.amazon.com/merch-tshirt/title-setup/new/upload_art" target="_blank" class="btn btn-success float-right">+ Add a new product</a><div class="header-stats rejected float-right" data-toggle="tooltip" data-placement="top" title="Rejected"><div class="number">0</div><div class="title">REJ</div></div><div class="header-stats processing float-right" data-toggle="tooltip" data-placement="top" title="Processing"><div class="number">0</div><div class="title">PS</div></div><div class="header-stats manual-review float-right" data-toggle="tooltip" data-placement="top" title="Under Manual Review"><div class="number">0</div><div class="title">UMR</div></div><div class="header-stats auto-review float-right" data-toggle="tooltip" data-placement="top" title="Under Auto Review"><div class="number">0</div><div class="title">UAR</div></div><div class="header-stats tier float-right clearfix" style="margin-right: 15px;"><div class="tier-text float-left"><div class="number">0</div><div class="title">TIER</div></div><div class="tier-icon float-right"></div></div></div></div><nav><div class="nav nav-tabs nav-fill" id="pretty-tabContent-tabs"><a id="nav-prettyDash-tab" class="nav-item nav-link active" data-toggle="tab" href="#nav-prettyDash"><span><i class="fa fa-desktop"></i> Dashboard</span></a><a id="nav-prettyAnalytics-tab" class="nav-item nav-link ' + (G_IS_PRO ? "" : "not-pro") + '" data-toggle="tab" href="#nav-prettyAnalytics"><span><i class="fa fa-bar-chart"></i> Analytics ' + O + '</span></a><a id="nav-prettyProducts-tab" class="nav-item nav-link ' + (G_IS_PRO ? "" : "not-pro") + '" data-toggle="tab" href="#nav-prettyProducts"><span><i class="fa fa-th"></i> Products ' + O + '</span></a><a class="nav-item nav-link no-tab trigger-options-modal" href=""><i class="fa fa-cog"></i> Options</a>' + (G_IS_PRO ? "" : '<a class="nav-item nav-link no-tab enter-licence" href=""><i class="fa fa-unlock"></i> Upgrade to Pro</a>') + '</div></nav><div class="tab-content" id="pretty-tabContent"><div id="nav-prettyDash" class="tab-pane fade show active"><div class="row" style="margin-bottom: 20px"><div class="col-6 total-limit"><div class="progress "><div class="progress-bar" role="progressbar" style="width: 0%; height: 20px; background-color:rgba(255, 206, 86, 1)" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div></div><div class="progress-text"><span class="used" style="font-weight: bold">0</span> of <span class="limit" style="font-weight: bold">0</span> <span style="">designs live</span></div></div><div class="col-6 daily-limit"><div class="progress"><div class="progress-bar" role="progressbar" style="width: 0%; height: 20px; background-color:rgba(75, 192, 192, 1)" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div></div><div class="progress-text uploads"><span class="used" style="font-weight: bold">0</span> of <span class="limit" style="font-weight: bold">0</span> <span style="">designs uploaded today</span></div><div class="progress-text special-message hidden"></div></div></div><div class="row" style="margin-bottom: 20px"><div class="col-4"><div class="card today-card"><div class="card-body sales-summary init-loader today"><div class=""><div class="title title-lg clearfix">Today\'s Sales<span class="subtitle"></span><div class="float-right text-right"></div></div><div class="net-sales odometer">0</div><div class="row no-gutters small-values"><div class="col" style="cursor: default" title="Sold - Cancelled"><span class="total-sales">0</span> - <span class="cancelled">0</span></div><div class="col"><span class="returned"><span class="number">0</span></span></div><div class="col" style="cursor: default"><span class="royalties">$<span class="number">0</span></span></div></div><div class="row no-gutters small-titles"><div class="col"><span class="">Sold</span> - <span class="" style="margin-right: 6px">Cancelled</span></div><div class="col"><span class="">Returned</span></div><div class="col"><span class="">Royalties</span></div></div></div></div></div></div><div class="col-8"><div class="card"><div class="card-body last-seven-days-chart" style="padding:0"><div class="title title-lg hidden">Last 7 Days<span class="subtitle"></span></div><canvas id="last-seven-days-chart" data-display="daily"></canvas></div></div></div></div><div class="row" style=""><div class="col-6" style="padding-right:0"><div class="card"><div class="card-body" style="padding: 15px 0 0px 0"><nav class="nav nav-tabs" id="myTab" style="position:relative"><a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-1" style="font-size:14px; font-weight:600">Products sold today</a><a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-2" >Top Units Sold</a><a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-3" >Top Royalties</a><div class="clearfix" style="position:absolute; right:0; bottom:10px; color:#a5a5a5; font-size:18px" title="Screenshot Mode: \nHides shirt titles so you can take a screenshot"><i class="fa fa-eye-slash" style="margin-right:5px; cursor: help" ></i><div class="switch-container float-right"><label for="blur_switch"><input type="checkbox" id="blur_switch" class="hide-titles" /><span class="switch"></span><span class="toggle"></span></label></div></div></nav><div class="tab-content" id="nav-tabContent" style="padding-top:5px"><div class="tab-pane fade show active" id="nav-1" role="tabpanel"><div class="todays-shirts-list"></div></div><div class="tab-pane fade" id="nav-2" role="tabpanel"><div class="sales-summary init-loader top-sellers"><div class="top-sales-list" style="height: 323px;"></div></div></div><div class="tab-pane fade" id="nav-3" role="tabpanel"><div class="sales-summary init-loader top-sellers"><div class="top-royalties-list" style="height: 323px;"></div></div></div></div></div></div></div><div class="col-6"><div class="card"><div class="card-body" style="padding-right:0; padding-bottom: 0px;"><div class="row" style="margin-bottom:15px; padding-bottom:15px"><div class="col-6 xcard-border-right"><div class="sales-summary summary-style-2 init-loader yesterday clearfix"><div class="title title-sm">Yesterday<span class="subtitle"></span><div class="text-right float-right"><div class="show-sales-modal btn btn-light btn-sm btn-icon ' + (G_IS_PRO ? "" : "not-pro") + '" data-period="yesterday" data-toggle="tooltip" title="View Sales"><i class="fa fa-list-ul"></i>' + O + '</div></div></div><div class="net-sales">0</div><div class="small-values"><div class="royalties-container"><span class="royalties">$<span class="number">0</span></span></div><div class="sold-container" title="Sold - Cancelled (Returned)"><span class="total-sales">0</span> - <span class="cancelled" style="margin-right: 6px">0</span>(<span class="returned">0</span>)</div></div></div></div><div class="col-6"><div class="sales-summary summary-style-2 init-loader last-seven-days clearfix"><div class="title title-sm">Last 7 Days<span class="subtitle"></span><div class="text-right float-right"><div class="show-sales-modal btn btn-light btn-sm btn-icon ' + (G_IS_PRO ? "" : "not-pro") + '" data-period="last-seven-days" data-toggle="tooltip" title="View Sales"><i class="fa fa-list-ul"></i>' + O + '</div></div></div><div class="net-sales">0</div><div class="small-values"><div class="royalties-container"><span class="royalties">$<span class="number">0</span></span></div><div class="sold-container" title="Sold - Cancelled (Returned)"><span class="total-sales">0</span> - <span class="cancelled" style="margin-right: 6px">0</span>(<span class="returned">0</span>)</div></div></div></div></div><div class="row" style="margin-bottom:15px; padding-bottom:15px"><div class="col-6"><div class="sales-summary summary-style-2 init-loader this-month clearfix"><div class="title title-sm">This Month<span class="subtitle"></span><div class="text-right float-right"><div class="show-sales-modal btn btn-light btn-sm btn-icon ' + (G_IS_PRO ? "" : "not-pro") + '" data-period="this-month" data-toggle="tooltip" title="View Sales"><i class="fa fa-list-ul"></i>' + O + '</div></div></div><div class="net-sales">0</div><div class="small-values"><div class="royalties-container"><span class="royalties">$<span class="number">0</span></span></div><div class="sold-container" title="Sold - Cancelled (Returned)"><span class="total-sales">0</span> - <span class="cancelled" style="margin-right: 6px">0</span>(<span class="returned">0</span>)</div></div></div></div><div class="col-6"><div class="sales-summary summary-style-2 init-loader previous-month clearfix"><div class="title title-sm">Previous Month<span class="subtitle"></span><div class="text-right float-right"><div class="show-sales-modal btn btn-light btn-sm btn-icon ' + (G_IS_PRO ? "" : "not-pro") + '" data-period="previous-month" data-toggle="tooltip" title="View Sales"><i class="fa fa-list-ul"></i>' + O + '</div></div></div><div class="net-sales">0</div><div class="small-values"><div class="royalties-container"><span class="royalties">$<span class="number">0</span></span></div><div class="sold-container" title="Sold - Cancelled (Returned)"><span class="total-sales">0</span> - <span class="cancelled" style="margin-right: 6px">0</span>(<span class="returned">0</span>)</div></div></div></div></div><div class="row"><div class="col-12"><div class="sales-summary summary-style-2 all-time clearfix"><div class="title title-sm clearfix">All Time<span class="subtitle"></span><span class="refresh-all-time-no-cache" data-toggle="tooltip" data-placement="top" data-html="true" title="Clear cache and Refresh"><i class="fa fa-refresh"></i></span><div class="text-right float-right"><div class="show-all-time-modal btn btn-light btn-sm btn-icon" data-toggle="tooltip" data-placement="top" data-html="true" title="View Chart"><i class="fa fa-bar-chart"></i></div></div></div><div class="net-sales">0</div><div class="small-values"><div class="royalties-container"><span class="royalties">$<span class="number">0</span></span></div><div class="sold-container" title="Sold - Cancelled (Returned)"><span class="total-sales">0</span> - <span class="cancelled" style="margin-right: 6px">0</span>(<span class="returned">0</span>)</div></div></div></div></div></div></div></div></div></div><div id="nav-prettyAnalytics" class="tab-pane fade"><div style="text-align: center; width: 550px; margin: 0 auto; margin-top: 50px;"><div style="font-size: 20px; line-height: 40px; margin-bottom: 20px"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="40px" height="40px" style="margin-right: 8px; "><span style="color:#f55d4c; margin-right:1px">Pretty</span><span style="color:#757575">Merch</span><span class="badge badge-primary" style="background-color: #f96e5f; margin-left: 6px; font-size: 12px; position: relative; top: -3px;">PRO</span></div><div class="" style="margin-bottom: 20px; font-size: 18px; line-height: 24px; color: #656565;">Coming soon in PrettyMerch PRO</div><div class="list" style="font-size: 16px; line-height: 22px; margin-bottom: 25px; padding: 0 40px; text-align: left">Select any date range to view:<ul style="color: #333; padding-left: 10px; margin-top: 6px;"><li style="color: #333">All Time sales: Detailed breakdown and analytics</li><li style="color: #333">Sales and royalties charts for daily and monthly sales</li><li style="color: #333">Total sales and royalties for the selected period</li><li style="color: #333">Detailed analytics of your sales grouped by product and fit type</li><li style="color: #333">How many of each product type, fit type and color you sold</li><li style="color: #333">Top sellers for the selected date range</li><li style="color: #333">Breakdown of each product you sold</li><li style="color: #333">Quickly edit any product with one click</li></ul></div></div></div><div id="nav-prettyProducts" class="tab-pane fade"><div style="text-align: center; width: 600px; margin: 0 auto; margin-top: 50px;"><div style="font-size: 20px; line-height: 40px; margin-bottom: 20px"><img src="' + chrome.extension.getURL("/img/pretty-logo.png") + '" width="40px" height="40px" style="margin-right: 8px; "><span style="color:#f55d4c; margin-right:1px">Pretty</span><span style="color:#757575">Merch</span><span class="badge badge-primary" style="background-color: #f96e5f; margin-left: 6px; font-size: 12px; position: relative; top: -3px;">PRO</span></div><div class="" style="margin-bottom: 20px; font-size: 18px; line-height: 24px; color: #656565;">Coming soon in PrettyMerch PRO</div><div class="list" style="font-size: 16px; line-height: 22px; margin-bottom: 25px; padding: 0 40px; text-align: left">A better, faster way to manage your products:<ul style="color: #333; padding-left: 10px; margin-top: 6px;"><li style="color: #333">See which products have sold and which have not</li><li style="color: #333">See which products are pending for removal and in how many days</li><li style="color: #333">Get a percentage of how many of your live products have sold</li><li style="color: #333">Filter by product type to see how many of each type you have live</li><li style="color: #333">Use smart search to filter products using only few characters</li><li style="color: #333">Large previews of the design so you can easily distinguish each product</li><li style="color: #333">Quickly edit any product with one click</li></ul></div></div></div></div>' + A + "</div></div>" + N + r + u + E + I + q + p + H + m + w + "";
                    $().add(K).appendTo("#prettydash-container");
                    if (G_LICENCE && !G_IS_PRO) {
                        $("#invalidLicenceMessage .title").html("Invalid Licence");
                        $("#invalidLicenceMessage .message").html(G_LICENCE + " - " + G_LICENCE_MSG);
                        $("#invalidLicenceMessage").removeClass("hidden")
                    }
                    if (typeof v.welcomeMessage != "undefined" && v.welcomeMessage != "") {
                        if (v.welcomeMessage.show_welcome_message) {
                            $("#welcomeMessage .title").html(v.welcomeMessage.title);
                            var z = v.welcomeMessage.message;
                            z += "Useful Links:<ul style='margin-top:8px'>";
                            z += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-android' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>Download <a href='http://www.prettymerch.com/r/android' target='_blank'>PrettyMerch for Android</a></li>", z += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-apple' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>Download <a href='http://www.prettymerch.com/r/ios' target='_blank'>PrettyMerch for iOS</a></li>", z += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-facebook' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>Like <a href='http://www.prettymerch.com/r/facebook' target='_blank'>PrettyMerch on Facebook</a> to keep up to date with new releases and upcoming features</li>", z += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-envelope-o' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>For questions/suggestions/comments/bugs - drop us a line at <b><a href='getprettymerch@gmail.com'>getprettymerch@gmail.com</a></b> - We read and reply to every email. Seriously</li>", z += "</ul>";
                            $("#welcomeMessage .message").html(z);
                            $("#welcomeMessage").removeClass("hidden")
                        }
                    }
                    if (typeof v.updateAvailableMessage != "undefined" && v.updateAvailableMessage != "") {
                        if (v.updateAvailableMessage.show_message) {
                            $("#updatesAvailableAlert .title").html(v.updateAvailableMessage.title);
                            $("#updatesAvailableAlert .message").html(v.updateAvailableMessage.message);
                            $("#updatesAvailableAlert").removeClass("hidden")
                        }
                    }
                    if (typeof v.updateMessage != "undefined" && v.updateMessage != "") {
                        if (v.updateMessage.show_update) {
                            $("#updatesAlert .title").html(v.updateMessage.title);
                            $("#updatesAlert .message").html(v.updateMessage.message);
                            var s = "";
                            if (v.updateMessage.free_list.length > 0) {
                                s = 'PrettyMerch Free:<ul style="margin-top:8px">';
                                for (x = 0; x < v.updateMessage.free_list.length; ++x) {
                                    s += '<li style="color: #004085; margin-bottom: 5px">' + v.updateMessage.free_list[x] + "</li>"
                                }
                                s += "</ul>"
                            }
                            var B = "";
                            if (v.updateMessage.pro_list.length > 0) {
                                B = 'PrettyMerch PRO:<ul style="margin-top:8px">';
                                for (x = 0; x < v.updateMessage.pro_list.length; ++x) {
                                    B += '<li style="color: #004085; margin-bottom: 5px">' + v.updateMessage.pro_list[x] + "</li>"
                                }
                                B += "</ul>"
                            }
                            var o = "";
                            o = 'Useful Links:<ul style="margin-top:8px">';
                            o += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-star' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>Interesting Fact: People who left a review for PrettyMerch on the Chrome Web Store have noticed a huge spike in sales... Ok, not really. We're just joking :) But we would really appreciate it if you could spare 1 minute to <a href='http://www.prettymerch.com/r/review-extension' target='_blank'><b>leave us a review</b></a>. It really helps us move up the ranks!</li>", o += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-android' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>Download <a href='http://www.prettymerch.com/r/android' target='_blank'>PrettyMerch for Android</a></li>", o += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-apple' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>Download <a href='http://www.prettymerch.com/r/ios' target='_blank'>PrettyMerch for iOS</a></li>", o += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-facebook' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>Like <a href='http://www.prettymerch.com/r/facebook' target='_blank'>PrettyMerch on Facebook</a> to keep up to date with new releases and upcoming features</li>", o += "<li style='color: #004085; margin-bottom: 5px'><i class='fa fa-envelope-o' style='width:16px;text-align:center;margin-right:5px;height:15px;color:#1775b5;'></i>For questions/suggestions/comments/bugs - drop us a line at <b><a href='getprettymerch@gmail.com'>getprettymerch@gmail.com</a></b> - We read and reply to every email. Seriously</li>", o += "</ul>";
                            $("#updatesAlert .list").html(s + B);
                            $("#updatesAlert").removeClass("hidden")
                        }
                    }
                    toggleLoaderDiv(".sales-summary.init-loader", "show");
                    toggleProgressBar(".last-seven-days-chart", "show", "Downloading Sales...");
                    toggleProgressBar(".sales-summary.all-time", "show", "Downloading Sales...");
                    var n = document.querySelector(".odometer");
                    if (n != null) {
                        od = new Odometer({el: n, value: 0, duration: 1500, theme: "minimal"})
                    }
                    g();
                    chrome.extension.sendMessage({initApp: "prettyDash"}, function (S) {
                    })
                })
            })
        } else {
            if (d.indexOf("landing") !== -1) {
                chrome.extension.sendMessage({user_logged_out: "true"}, function (h) {
                })
            } else {
                if (d.indexOf("merch.amazon.com") != -1) {
                    a.find("a").first().prop("href", "/dashboard?oldDash");
                    c.insertBefore(a);
                    b.css("display", "block");
                    if (d.indexOf("merch.amazon.com/resource") != -1) {
                    } else {
                        chrome.extension.sendMessage({initApp: "otherPage"}, function (h) {
                        })
                    }
                }
            }
        }
    }

    function g() {
        $('[data-toggle="tooltip"]').tooltip();
        $('[data-toggle="popover"]').popover();
        $(".show-beta-options").click(function () {
            $("#optionsModal .beta-options").removeClass("hidden")
        });
        $(".show-logout-modal").click(function () {
            var k = {backdrop: "static", keyboard: false};
            showModal("#loggedOutModal", k)
        });
        $(".show-tier-up-modal").click(function () {
            showModal("#tierUpModal");
            confetti("confetti-canvas", "start")
        });
        $(".close-tier-up-modal").click(function () {
            confetti("confetti-canvas", "stop")
        });
        $(".trigger-check-for-sales").click(function () {
            chrome.extension.sendMessage({manual_check_for_sales: true})
        });
        $(".trigger-do-misc-tasks").click(function () {
            chrome.extension.sendMessage({trigger_do_misc_tasks: true})
        });
        $(".trigger-check-for-tier-up").click(function () {
            chrome.extension.sendMessage({manual_check_for_tier_up: true})
        });
        $(".trigger-auto-login").click(function () {
            chrome.extension.sendMessage({trigger_auto_login: true})
        });
        $(".update-extension-now").click(function () {
            var k = $(this);
            k.html("Updating...").prop("disabled", true);
            showModal("#updateProgressModal");
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "20%")
            }, 1000);
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "30%")
            }, 2000);
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "40%")
            }, 3000);
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "50%")
            }, 4000);
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "60%")
            }, 5000);
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "70%")
            }, 6000);
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "80%")
            }, 7000);
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "90%")
            }, 8000);
            setTimeout(function () {
                $("#updateProgressModal .progress-bar").css("width", "100%");
                $("#updateProgressModal .progress-text").html("<b>All done, please reload the page</b>");
                $("#updateProgressModal .reload-page").addClass("show")
            }, 9000);
            chrome.extension.sendMessage({update_extension_now: true})
        });
        $("#updateProgressModal .reload-page").click(function () {
            window.location.reload()
        });
        $(".clear-welcome-message").click(function () {
            chrome.storage.sync.remove("welcomeMessage")
        });
        $(".clear-update-available").click(function () {
            chrome.storage.sync.remove("updateAvailableMessage")
        });
        $(".clear-update").click(function () {
            chrome.storage.sync.remove("updateMessage")
        });
        $(".refresh-all-time-no-cache").click(function () {
            chrome.extension.sendMessage({refresh_all_time_no_cache: true})
        });
        $(".show-all-time-modal").click(function () {
            showSalesChartModal()
        });
        $(document).on("hidden.bs.modal", "#chartModal", function () {
            chartContainers.sales_chart.destroy()
        });
        $(".show-sales-modal").click(function () {
            _this = $(this);
            if (G_IS_PRO) {
                var m = _this.data("period");
                var k = 0;
                var l = 0;
                var n = "#salesModal .shirt-list";
                if (m == "custom") {
                    k = _this.data("startDate");
                    l = _this.data("endDate")
                }
                showSalesModal(m, k, l, n)
            } else {
                showAvailableInProMessage("summary_click")
            }
        });
        $(document).on("change", ".hide-titles", function () {
            selectedInput = $(this);
            if (selectedInput.is(":checked")) {
                $(".hide-in-screenshot").addClass("blur-contents")
            } else {
                $(".hide-in-screenshot").removeClass("blur-contents")
            }
            $(".hide-titles").each(function (k, l) {
                $(l).prop("checked", selectedInput.is(":checked"))
            })
        });
        $(document).on("click", ".trigger-options-modal", function (m) {
            m.preventDefault();
            $("#optionsModal .is-invalid").each(function (n, o) {
                $(o).removeClass("is-invalid")
            });
            var l = {
                show_sales_notif: true,
                sales_notif_sound: "cha-ching-1",
                show_logout_notif: true,
                logout_notif_sound: "attention-6",
                tax_rate: 0,
                auto_re_login: {is_enabled: false, arl_email: "", arl_password: ""}
            };
            var k = logged_in_user + "_options";
            chrome.storage.sync.get(k, function (n) {
                if (typeof n[k] != "undefined") {
                    l = {
                        show_sales_notif: n[k].show_sales_notif || l.show_sales_notif,
                        sales_notif_sound: n[k].sales_notif_sound || l.sales_notif_sound,
                        show_logout_notif: n[k].show_logout_notif || l.show_logout_notif,
                        logout_notif_sound: n[k].logout_notif_sound || l.logout_notif_sound,
                        tax_rate: n[k].tax_rate || l.tax_rate,
                        auto_re_login: (n[k].auto_re_login ? {
                            is_enabled: (G_IS_PRO ? n[k].auto_re_login.is_enabled || l.auto_re_login.is_enabled : false),
                            arl_email: (n[k].auto_re_login.arl_email ? atob(n[k].auto_re_login.arl_email) : l.auto_re_login.arl_email),
                            arl_password: (n[k].auto_re_login.arl_password ? atob(n[k].auto_re_login.arl_password) : l.auto_re_login.arl_password)
                        } : l.auto_re_login)
                    }
                } else {
                }
                $(".options-form #salesNotif").prop("checked", l.show_sales_notif);
                $(".options-form input[name=saleSound][value=" + l.sales_notif_sound + "]").prop("checked", true);
                if (!l.show_sales_notif) {
                    $(".saleSound-options input").each(function (o) {
                        $(this).prop("disabled", true)
                    })
                }
                $(".options-form #logoutNotif").prop("checked", l.show_logout_notif);
                $(".options-form input[name=logoutSound][value=" + l.logout_notif_sound + "]").prop("checked", true);
                if (!l.show_logout_notif) {
                    $(".logoutSound-options input").each(function (o) {
                        $(this).prop("disabled", true)
                    })
                }
                $(".options-form #input_taxRate").val(l.tax_rate);
                if (!G_IS_PRO) {
                    $(".options-form #allow_autoReLogin").prop("disabled", true)
                }
                $(".options-form #allow_autoReLogin").prop("checked", l.auto_re_login.is_enabled);
                $(".options-form #input_arl_email").val(l.auto_re_login.arl_email);
                $(".options-form #input_arl_password").val(l.auto_re_login.arl_password);
                if (!l.auto_re_login.is_enabled) {
                    $(".options-form .autoReLogin-options input").each(function (o) {
                        $(this).prop("disabled", true)
                    })
                }
                showModal("#optionsModal")
            })
        });
        $(document).on("change", ".options-form input", function (k) {
            selectedInput = $(this);
            if (selectedInput.attr("id") == "salesNotif") {
                if (selectedInput.is(":checked")) {
                    $(".saleSound-options input").each(function (l) {
                        $(this).prop("disabled", false)
                    })
                } else {
                    $(".saleSound-options input").each(function (l) {
                        $(this).prop("disabled", true)
                    })
                }
            }
            if (selectedInput.attr("id") == "logoutNotif") {
                if (selectedInput.is(":checked")) {
                    $(".logoutSound-options input").each(function (l) {
                        $(this).prop("disabled", false)
                    })
                } else {
                    $(".logoutSound-options input").each(function (l) {
                        $(this).prop("disabled", true)
                    })
                }
            }
            if (selectedInput.attr("id") == "allow_autoReLogin") {
                if (selectedInput.is(":checked")) {
                    $(".options-form .autoReLogin-options input").each(function (l) {
                        $(this).prop("disabled", false)
                    })
                } else {
                    $(".options-form .autoReLogin-options input").each(function (l) {
                        $(this).prop("disabled", true)
                    })
                }
            }
        });
        $(document).on("click", "#saveOptions", function (l) {
            var k = $(this);
            h(function (p) {
                if (p) {
                    $("#optionsModal .is-invalid").each(function (q, r) {
                        $(r).removeClass("is-invalid")
                    });
                    var o = (G_TAX_RATE != parseInt($(".options-form #input_taxRate").val()));
                    var m = o;
                    if (m) {
                        k.html("Reloading page...").prop("disabled", true)
                    } else {
                        k.html("Saving...").prop("disabled", true)
                    }
                    var n = {
                        show_sales_notif: $(".options-form #salesNotif").is(":checked"),
                        sales_notif_sound: $(".options-form input[name=saleSound]:checked").val(),
                        show_logout_notif: $(".options-form #logoutNotif").is(":checked"),
                        logout_notif_sound: $(".options-form input[name=logoutSound]:checked").val(),
                        tax_rate: parseInt($(".options-form #input_taxRate").val()),
                        auto_re_login: {
                            is_enabled: $(".options-form #allow_autoReLogin").is(":checked"),
                            arl_email: btoa($(".options-form #input_arl_email").val().trim()),
                            arl_password: btoa($(".options-form #input_arl_password").val().trim())
                        }
                    };
                    G_TAX_RATE = n.tax_rate;
                    chrome.extension.sendMessage({saveOptions: true, options: n}, function (q) {
                        if (m) {
                            window.location.reload()
                        } else {
                            k.html("Save").prop("disabled", false);
                            $("#optionsModal").modal("hide")
                        }
                    })
                } else {
                }
            })
        });

        function h(m) {
            var l = true;
            $("#optionsModal .is-invalid").each(function (n, o) {
                $(o).removeClass("is-invalid")
            });
            var k = parseInt($(".options-form #input_taxRate").val());
            if (!j(k) || k < 0 || k > 100) {
                l = false;
                $(".options-form #input_taxRate").addClass("is-invalid")
            }
            if ($(".options-form #allow_autoReLogin").is(":checked")) {
                if ($(".options-form #input_arl_email").val().trim() == "") {
                    l = false;
                    $(".options-form #input_arl_email").addClass("is-invalid")
                }
                if ($(".options-form #input_arl_password").val().trim() == "") {
                    l = false;
                    $(".options-form #input_arl_password").addClass("is-invalid")
                }
            }
            if (typeof m === "function") {
                m(l)
            }
        }

        function j(k) {
            return !isNaN(k) && parseInt(Number(k)) == k && !isNaN(parseInt(k, 10))
        }

        $(document).on("click", ".options-form .play_sound", function (l) {
            this_sound = $(this).parent().find("input").val();
            var k = document.createElement("audio");
            k.src = chrome.extension.getURL("/mp3/" + this_sound + ".mp3");
            k.play()
        });
        $(document).on("click", ".enter-licence", function (k) {
            k.preventDefault();
            if (G_LICENCE) {
                $("#licenceModal .licenceKey").val(G_LICENCE)
            }
            showModal("#licenceModal")
        });
        $("#licenceModal").on("shown.bs.modal", function () {
            $("#licenceModal .licenceKey").removeClass("is-invalid").focus()
        });
        $(document).on("click", ".delete-licence", function (l) {
            var k = logged_in_user + btoa("_licence");
            chrome.storage.sync.remove(k)
        });
        $(".saveLicence").click(function () {
            var n = $("#licenceModal");
            var m = $("#enterLicenceForm");
            var l = encodeURIComponent(m.find(".licenceKey").val().trim());
            var k = $(this);
            k.html("Saving...").prop("disabled", true);
            m.find("fieldset").prop("disabled", true);
            m.find(".licenceKey").removeClass("is-invalid");
            validateLicence(l, function (o) {
                if (o.isValid) {
                    n.find(".purchaseLicence").addClass("hidden");
                    k.toggleClass("btn-success", "btn-primary").html("Success! Reloading page...");
                    var q = logged_in_user + btoa("_licence");
                    var p = {ul: btoa(l), iv: btoa(o.isValid), lm: ""};
                    if (logged_in_user) {
                        memopts = {};
                        memopts[q] = p;
                        chrome.storage.sync.set(memopts, function (r) {
                            window.location.reload()
                        })
                    }
                } else {
                    k.html("Save Licence").prop("disabled", false);
                    m.find("fieldset").prop("disabled", false);
                    m.find(".invalid-feedback").html(o.msg);
                    m.find(".licenceKey").addClass("is-invalid")
                }
            })
        });
        Chart.plugins.register({
            afterDatasetsDraw: function (l, m) {
                var k = l.ctx;
                l.data.datasets.forEach(function (p, n) {
                    var o = l.getDatasetMeta(n);
                    if (!o.hidden && p.label != "Royalties") {
                        o.data.forEach(function (s, v) {
                            if (v == o.data.length - 1) {
                                k.fillStyle = "#757575"
                            } else {
                                if (p.data[v] == 0) {
                                    k.fillStyle = "#b1b1b1"
                                } else {
                                    k.fillStyle = "#2385c7"
                                }
                            }
                            var z = 16;
                            var r = "normal";
                            var w = "Lato";
                            k.font = Chart.helpers.fontString(z, r, w);
                            var u = p.data[v].toString();
                            k.textAlign = "center";
                            k.textBaseline = "middle";
                            var y = 7;
                            var t = s.tooltipPosition();
                            if (t.y <= (z + y)) {
                                var q = t.y + (z / 2) + y
                            } else {
                                var q = t.y - (z / 2) - y
                            }
                            k.fillText(u, t.x, q)
                        })
                    }
                })
            }
        });
        $(document).on("show.bs.modal", ".modal", function (k) {
            var l = 1040 + (10 * $(".modal:visible").length);
            $(this).css("z-index", l);
            setTimeout(function () {
                $(".modal-backdrop").not(".modal-stack").css("z-index", l - 1).addClass("modal-stack")
            }, 0)
        });
        $(document).on("hidden.bs.modal", ".modal", function () {
            $(".modal:visible").length && $(document.body).addClass("modal-open")
        })
    }
});
document.onreadystatechange = function () {
    chrome.extension.sendMessage({
        show_in_bg_log: "true",
        msg: moment().format("HH:mm:ss") + " document.readyState = " + document.readyState
    });
    switch (document.readyState) {
        case"loading":
            break;
        case"interactive":
            var c = window.location.href;
            if (c.indexOf("signin") != -1 && c.indexOf("merch.amazon.com") != -1 && c.indexOf("autoReLogin") != -1) {
                function a() {
                    onmessage = function (d) {
                        setTimeout(function () {
                            postMessage("go")
                        }, 100)
                    }
                }

                if (window != self) {
                    a()
                }
                var b = new Worker(URL.createObjectURL(new Blob(["(" + a.toString() + ")()"], {type: "text/javascript"})));
                b.postMessage(0);
                chrome.extension.sendMessage({
                    show_in_bg_log: "true",
                    msg: moment().format("HH:mm:ss") + " Creating test_worker"
                });
                b.onmessage = function (d) {
                    chrome.extension.sendMessage({
                        show_in_bg_log: "true",
                        msg: moment().format("HH:mm:ss") + " Running test_worker"
                    });
                    chrome.extension.sendMessage({loaded_auto_re_login: "true"}, function (e) {
                        chrome.extension.sendMessage({
                            show_in_bg_log: "true",
                            msg: moment().format("HH:mm:ss") + " Login page Received message from bg"
                        })
                    })
                };
                b.onerror = function (d) {
                    chrome.extension.sendMessage({show_in_bg_log: "true", msg: "test_worker got en error " + d.data})
                }
            }
            break;
        case"complete":
            break
    }
};