moment.tz.setDefault("America/Los_Angeles");var debugMode=false;var showTestSales=false;var test_count=0;var us_marketplace_id="ATVPDKIKX0DER";var xml_success_responsees=[200,201,202,203,204,205,206,207,226];var G_IS_PRO=false;var G_AUTOLOGIN_TAB=false;var G_ATTEMPT_AUTO_RE_LOGIN=true;var G_COUNT_LOGIN_ATTEMPTS=0;var G_ARL_LOGGED_OUT_MSG="";var alarmOpts={delayInMinutes:1,periodInMinutes:1};var beginning_of_time=moment("2015-09-01").startOf("day");var loggedIn=true;var checkingLogIn=false;var welcomeNotification=false;var loggedOutNotification=false;var newSaleNotification=false;var showLogoutNotification=true;var sales_sound=document.createElement("audio");var loggout_out_sound=document.createElement("audio");var opt_showLogoutNotif=true;var opt_showSalesNotif=true;var opt_tax_rate=0;var OPT_AUTO_RE_LOGIN=false;var OPT_AUTO_RE_LOGIN_EMAIL="";var OPT_AUTO_RE_LOGIN_PASSWORD="";var logged_in_user="tmp_user";var doingInitMain=false;initMain(function(){});function initMain(b){doingInitMain=true;chrome.storage.local.get("app_data",function(c){if(typeof c.app_data!="undefined"&&c.app_data!=""){logged_in_user=c.app_data.s_id}else{}initCommon(function(){fetchOptions(function(){a()})})});function a(){doingInitMain=false;if(typeof b==="function"){b()}}}function waitForinitMain(e){var b=300;if(doingInitMain){var a=setTimeout(c,50);function c(){if(doingInitMain){a=setTimeout(c,b)}else{clearTimeout(a);d()}}}else{d()}function d(){if(typeof e==="function"){e()}}}function fetchOptions(c){var a=logged_in_user+"_options";chrome.storage.sync.get(a,function(e){if(typeof e[a]!="undefined"){opt_showLogoutNotif=e[a].show_logout_notif;opt_showSalesNotif=e[a].show_sales_notif;if(e[a].sales_notif_sound=="no_sound"){sales_sound=false}else{sales_sound.src=chrome.extension.getURL("/mp3/"+e[a].sales_notif_sound+".mp3")}if(e[a].logout_notif_sound=="no_sound"){loggout_out_sound=false}else{loggout_out_sound.src=chrome.extension.getURL("/mp3/"+e[a].logout_notif_sound+".mp3")}if(e[a].tax_rate){opt_tax_rate=e[a].tax_rate}else{opt_tax_rate=0}OPT_AUTO_RE_LOGIN=(e[a].auto_re_login?e[a].auto_re_login.is_enabled:false);OPT_AUTO_RE_LOGIN_EMAIL=(e[a].auto_re_login?atob(e[a].auto_re_login.arl_email):"");OPT_AUTO_RE_LOGIN_PASSWORD=(e[a].auto_re_login?atob(e[a].auto_re_login.arl_password):"")}else{var d={show_sales_notif:true,sales_notif_sound:"cha-ching-1",show_logout_notif:true,logout_notif_sound:"attention-6",tax_rate:0,auto_re_login:{is_enabled:false,arl_email:"",arl_password:""}};saveOptions(d)}b()});function b(){if(typeof c==="function"){c()}}}function saveOptions(b){opt_showLogoutNotif=b.show_logout_notif;opt_showSalesNotif=b.show_sales_notif;if(b.sales_notif_sound=="no_sound"){sales_sound=false}else{sales_sound.src=chrome.extension.getURL("/mp3/"+b.sales_notif_sound+".mp3")}if(b.logout_notif_sound=="no_sound"){loggout_out_sound=false}else{loggout_out_sound.src=chrome.extension.getURL("/mp3/"+b.logout_notif_sound+".mp3")}if(b.tax_rate){opt_tax_rate=b.tax_rate}else{opt_tax_rate=0}OPT_AUTO_RE_LOGIN=(b.auto_re_login?b.auto_re_login.is_enabled:false);OPT_AUTO_RE_LOGIN_EMAIL=(b.auto_re_login?atob(b.auto_re_login.arl_email):"");OPT_AUTO_RE_LOGIN_PASSWORD=(b.auto_re_login?atob(b.auto_re_login.arl_password):"");if(logged_in_user){var a={};a[logged_in_user+"_options"]=b;chrome.storage.sync.set(a,function(){})}}function checkLicence(){var a=logged_in_user+btoa("_licence");chrome.storage.sync.get(a,function(d){if(typeof d[a]!="undefined"){var e=atob(d[a].ul);var c=atob(d[a].iv);var b=atob(d[a].lm);validateLicence(e,function(f){G_IS_PRO=(f.isValid?true:false);var g={ul:btoa(e),iv:btoa(f.isValid),cd:btoa(f.subscription_cancelled_at),fd:btoa(f.subscription_failed_at),lm:btoa(f.msg)};if(logged_in_user){memopts={};memopts[a]=g;chrome.storage.sync.set(memopts)}})}else{G_IS_PRO=false}})}function handleLogIn(a){logged_in_user=a;var b={s_id:a};chrome.storage.local.set({app_data:b});authenticated=false;++G_COUNT_LOGIN_ATTEMPTS;fetchOptions();checkLicence()}function doCheckLoginFallback(){chrome.tabs.onUpdated.removeListener(autoReLoginListener);chrome.storage.local.get("arl_data",function(a){if(typeof a.arl_data!="undefined"&&a.arl_data!=""){G_AUTOLOGIN_TAB=a.arl_data.arl_tab_id}chrome.tabs.remove(G_AUTOLOGIN_TAB);G_ATTEMPT_AUTO_RE_LOGIN=false;G_ARL_LOGGED_OUT_MSG="Auto Re-Login couldn't log you back in. The login attempt timed out";checkLogIn()})}function triggerAutoReLogin(){if(!G_AUTOLOGIN_TAB){G_AUTOLOGIN_TAB=true;chrome.alarms.clearAll();chrome.tabs.onUpdated.removeListener(autoReLoginListener);setTimeout(function(){chrome.tabs.onUpdated.addListener(autoReLoginListener);chrome.tabs.create({url:"https://merch.amazon.com/dashboard?autoReLogin",active:false,pinned:true},function(a){G_AUTOLOGIN_TAB=a.id;var b={arl_tab_id:G_AUTOLOGIN_TAB};chrome.storage.local.set({arl_data:b},function(){chrome.tabs.update(G_AUTOLOGIN_TAB,{autoDiscardable:false},function(c){})})});chrome.alarms.create("doCheckLoginFallback",{delayInMinutes:1})},100)}else{}}function handleLogOut(){if(loggedIn){if(G_IS_PRO&&OPT_AUTO_RE_LOGIN&&G_ATTEMPT_AUTO_RE_LOGIN){triggerAutoReLogin()}else{loggedIn=false;var b={update:"loggedOut",msg:G_ARL_LOGGED_OUT_MSG};updateTabs(b);chrome.alarms.clearAll(function(c){});var a={type:"basic",isClickable:true,requireInteraction:false,title:"You are signed out of Merch by Amazon",message:"Sign in to get updates on your sales",iconUrl:chrome.extension.getURL("/img/notificationLogo.png"),buttons:[{title:"Sign in to Merch by Amazon",iconUrl:chrome.extension.getURL("/img/sign-in-icon.png")},{title:"Close",iconUrl:chrome.extension.getURL("/img/close-icon.png")}]};if(opt_showLogoutNotif&&showLogoutNotification&&!loggedOutNotification&&!welcomeNotification){loggedOutNotification=true;chrome.notifications.create(a,function(c){loggedOutNotification=c;if(loggout_out_sound){loggout_out_sound.play()}})}showLogoutNotification=true;setBrowserIcons("inactive")}}}function forceLogout(b){$.ajax({url:"https://www.amazon.com/ap/signin?openid.return_to=https%3A%2F%2Fmerch.amazon.com&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=amzn_gear_us&openid.mode=logout&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&",type:"GET",data:{numberOfWords:10},dataType:"json",success:function(c){a()},error:function(d,c){a()}});function a(){if(typeof b==="function"){b()}}}function checkLogIn(e){if(!checkingLogIn){checkingLogIn=true;var c=false;var a="https://merch.amazon.com/merchandise/list?pageSize=1&pageNumber=1&statusFilters%5B%5D=REJECTED&keywords=";var b=new XMLHttpRequest();b.open("GET",a,true);b.onreadystatechange=function(){if(b.readyState==4){if(xml_success_responsees.indexOf(b.status)===-1){handleLogOut()}else{if(b.responseText.indexOf("AuthenticationPortal")!=-1){handleLogOut()}else{loggedIn=true;c=true}}checkingLogIn=false;d(c)}};b.send()}function d(f){if(typeof e==="function"){e(f)}}}function doMiscTasks(a){a=a||0;waitForinitMain(function(){setTimeout(function(){findOpenTabs(function(b){if(b.length>0){getAmazonMessages();getUserEarnings()}else{}})},a)})}function getAmazonMessages(b){if(loggedIn){b=b||0;var a="https://merch.amazon.com/messages";var c=new XMLHttpRequest();c.open("GET",a,true);c.onreadystatechange=function(){if(c.readyState==4){if(xml_success_responsees.indexOf(c.status)===-1){checkLogIn()}else{if(c.responseText.indexOf("AuthenticationPortal")!=-1){handleLogOut()}else{var e=$.parseHTML(c.responseText);var f=$("<div></div>");$.each(e,function(l,m){if(m.nodeName=="RENDEREDHTML"){f.html(m.innerText)}});var j=f.find("li:first .a-row.a-spacing-medium").html();var h=f.find("li:first .a-spacing-micro.a-color-tertiary").html();if(j){var d={};var g=logged_in_user+"_latestAmzMessage";chrome.storage.sync.get(g,function(l){if(typeof l[g]!="undefined"&&l[g]!=""){var o=l[g].msg;if(o==j){}else{var n={msg:j,date:h};if(logged_in_user){d={};d[g]=n;chrome.storage.sync.set(d)}var m={update:"showAmzMessage",data:n};updateTabs(m)}}else{var n={msg:j,date:h};if(logged_in_user){d={};d[g]=n;chrome.storage.sync.set(d)}}})}}}}};setTimeout(function(){c.send()},b)}}function getUserEarnings(b){if(loggedIn){b=b||0;var a="https://merch.amazon.com/product-earnings-summary";var c=new XMLHttpRequest();c.open("GET",a,true);c.onreadystatechange=function(){if(c.readyState==4){if(xml_success_responsees.indexOf(c.status)===-1){checkLogIn()}else{if(c.responseText.indexOf("AuthenticationPortal")!=-1){handleLogOut()}else{var e=JSON.parse(c.responseText);var g=e.earningsMonth+" "+e.earningsYear;if(g){var d={};var f=logged_in_user+"_latestEarnings";chrome.storage.sync.get(f,function(h){if(typeof h[f]!="undefined"&&h[f]!=""){var m=h[f].date;if(m==g){}else{var l={date:g,earnings:e};if(logged_in_user){d={};d[f]=l;chrome.storage.sync.set(d)}var j={update:"showLatestEarnings",data:l};updateTabs(j)}}else{var l={date:g,earnings:e};if(logged_in_user){d={};d[f]=l;chrome.storage.sync.set(d)}}})}}}}};setTimeout(function(){c.send()},b)}}function getPublishedItemsSummary(){if(loggedIn){var b={};var a="https://merch.amazon.com/accountSummary";var c=new XMLHttpRequest();c.open("GET",a,true);c.onreadystatechange=function(){if(c.readyState==4){if(xml_success_responsees.indexOf(c.status)===-1){checkLogIn()}else{if(c.responseText.indexOf("AuthenticationPortal")!=-1){handleLogOut()}else{var f=JSON.parse(c.responseText);var e=moment().startOf("day").valueOf();var j;var d={};var h=logged_in_user+"_maxAllowedSubmissions";var g=logged_in_user+"_currentTier";chrome.storage.sync.get([h,g],function(v){if(typeof v[h]!="undefined"&&v[h]!=""){j=v[h]}else{j={lastUpdate:e,num:f.dailySubmissionCountRemaining};if(logged_in_user){d={};d[h]=j;chrome.storage.sync.set(d)}}if(e>j.lastUpdate){j={lastUpdate:e,num:f.dailySubmissionCountRemaining};if(logged_in_user){d={};d[h]=j;chrome.storage.sync.set(d)}}var o=j.num-f.dailySubmissionCountRemaining;if(o<0){var m=f.dailySubmissionCountRemaining;o=m-f.dailySubmissionCountRemaining;j={lastUpdate:e,num:m};if(logged_in_user){d={};d[h]=j;chrome.storage.sync.set(d)}}var t=(o/j.num)*100;b.numUploaded=o;b.maxAllowedSubmissions=parseInt(j.num);b.numUploadedPercent=t;b.eligibilityStatus=f.eligibilityStatus;var r;var q;var p=[{tier_limit:10,tier_name:"Rookie",tier_img:chrome.extension.getURL("/img/tier10.png")},{tier_limit:25,tier_name:"Just Warming Up",tier_img:chrome.extension.getURL("/img/tier25.png")},{tier_limit:100,tier_name:"Raw Skills",tier_img:chrome.extension.getURL("/img/tier100.png")},{tier_limit:500,tier_name:"Let's Rock",tier_img:chrome.extension.getURL("/img/tier500.png")},{tier_limit:1000,tier_name:"Graphic Genius",tier_img:chrome.extension.getURL("/img/tier1000.png")},{tier_limit:2000,tier_name:"Veteran",tier_img:chrome.extension.getURL("/img/tier2000.png")},{tier_limit:4000,tier_name:"Total Charisma",tier_img:chrome.extension.getURL("/img/tier4000.png")},{tier_limit:6000,tier_name:"Extreme",tier_img:chrome.extension.getURL("/img/tier6000.png")},{tier_limit:8000,tier_name:"Elite",tier_img:chrome.extension.getURL("/img/tier8000.png")},{tier_limit:10000,tier_name:"Trend Setter",tier_img:chrome.extension.getURL("/img/tier10000.png")},{tier_limit:12000,tier_name:"Heroic",tier_img:chrome.extension.getURL("/img/tier12000.png")},{tier_limit:14000,tier_name:"Legendary",tier_img:chrome.extension.getURL("/img/tier14000.png")},{tier_limit:16000,tier_name:"Super-Human",tier_img:chrome.extension.getURL("/img/tier16000.png")},{tier_limit:20000,tier_name:"Unicorn Squad",tier_img:chrome.extension.getURL("/img/tier20000.png")},{tier_limit:22000,tier_name:"Merch Visionary",tier_img:chrome.extension.getURL("/img/tier22000.png")},{tier_limit:24000,tier_name:"Mythical Designer",tier_img:chrome.extension.getURL("/img/tier24000.png")},{tier_limit:26000,tier_name:"Out Of This World",tier_img:chrome.extension.getURL("/img/tier26000.png")},{tier_limit:100000,tier_name:"Golden Unicorn",tier_img:chrome.extension.getURL("/img/tier100000.png")}];for(i=0;i<p.length;++i){if(f.publishedItemCountLimit>=p[i].tier_limit){r=p[i].tier_name;q=p[i].tier_img}}var s=(f.publishedItemCount/f.publishedItemCountLimit)*100;b.publishedItemPercent=s;b.publishedItemCount=parseInt(f.publishedItemCount);b.publishedItemCountLimit=parseInt(f.publishedItemCountLimit);b.tier_name=r;b.tier_img=q;var u={update:"publishedItemsSummary",data:b};updateTabs(u);if(typeof v[g]!="undefined"&&v[g]!=""){var n=v[g].tier;if(parseInt(f.publishedItemCountLimit)>n){var l={tier:parseInt(f.publishedItemCountLimit)};if(logged_in_user){d={};d[g]=l;chrome.storage.sync.set(d)}var u={update:"showTierUpModal",data:{tier:parseInt(f.publishedItemCountLimit),tier_img:q,tier_name:r}};updateTabs(u)}else{}}else{var l={tier:parseInt(f.publishedItemCountLimit)};if(logged_in_user){d={};d[g]=l;chrome.storage.sync.set(d)}}})}}}};c.send()}}function getProcessingItems(){if(loggedIn){var b={};var c="https://merch.amazon.com/merchandise/list?pageSize=200&pageNumber=1&statusFilters%5B%5D=PROCESSING&statusFilters%5B%5D=PENDING&statusFilters%5B%5D=UNDER_REVIEW&statusFilters%5B%5D=REJECTED&keywords=";var a=new XMLHttpRequest();a.open("GET",c,true);a.onreadystatechange=function(){if(a.readyState==4){if(xml_success_responsees.indexOf(a.status)===-1){checkLogIn()}else{if(a.responseText.indexOf("AuthenticationPortal")!=-1){handleLogOut()}else{var j=JSON.parse(a.responseText);var h=0;var e=0;var d=0;var g=0;for(i=0;i<j.merchandiseList.length;i++){if(j.merchandiseList[i].status=="UNDER_AUTO_REVIEW"){++h}if(j.merchandiseList[i].status=="PROCESSING"||j.merchandiseList[i].status=="PENDING"){++e}if(j.merchandiseList[i].status=="UNDER_REVIEW"){++d}if(j.merchandiseList[i].status=="REJECTED"||j.merchandiseList[i].status=="MANUALLY_REJECTED"){++g}}b.total_auto_review=h;b.total_manual_review=d;b.total_processing=e;b.total_rejected=g;var f={update:"processingItemsSummary",data:b};updateTabs(f)}}}};a.send()}}function getSalesSummary(p,f,l,e,j,g,r){if(loggedIn){var b=p;var a=e;j=j||0;g=g||false;var c={};var o=moment().startOf("day");var n=0;var q;var s={toggleLoaderDiv:true,container:a,action:"show"};updateTabs(s);switch(b){case"today":f=o;l=o;q=f.format("M/D/YY");break;case"yesterday":f=moment(o).subtract(1,"days");l=moment(o).subtract(1,"days");q=f.format("M/D");break;case"last-seven-days":f=moment(o).subtract(7,"days");l=moment(o);q=f.format("M/D")+" - "+l.format("M/D");break;case"last-two-weeks":f=moment(o).subtract(14,"days");l=moment(o);q=f.format("M/D")+" - "+l.format("M/D");break;case"this-month":f=moment(o).startOf("month");l=moment(o);q=f.format("M/D")+" - "+l.format("M/D");break;case"previous-month":f=moment(o).subtract(1,"month").startOf("month");l=moment(o).subtract(1,"month").endOf("month").startOf("day");q=f.format("MMM YY");break;case"top-sellers":f=moment(o).subtract(30,"days");l=o;break;case"custom":f=moment(f).startOf("day");l=moment(l).startOf("day");q=f.format("MM/DD/YY")+" - "+l.format("MM/DD/YY");break;default:break}c.result_container=a;c.title_date=q;var m="https://merch.amazon.com/product-purchases-records?fromDate="+f.valueOf()+"&toDate="+l.valueOf();var h=new XMLHttpRequest();h.open("GET",m,true);h.onreadystatechange=function(){if(h.readyState==4){if(xml_success_responsees.indexOf(h.status)===-1){checkLogIn()}else{if(h.responseText.indexOf("AuthenticationPortal")!=-1){handleLogOut()}else{var d=JSON.parse(h.responseText);if(b=="top-sellers"){var u={};var A=[];var F=0;Object.keys(d).forEach(function(Q){var R=d[Q][us_marketplace_id][0].unitsSold-d[Q][us_marketplace_id][0].unitsCancelled;if(R>0){A[F]=d[Q][us_marketplace_id][0];A[F].net_sold=R;A[F].royalties=parseFloat(A[F].royaltyValue).toFixed(2);++F}});var E=(A.length>10?10:A.length);c.top_sellers=A.sort(function(R,Q){return Q.net_sold-R.net_sold}).slice(0,E);c.top_royalties=A.sort(function(R,Q){return Q.royalties-R.royalties}).slice(0,E);findVariationTotals(c.top_sellers,function(Q){c.top_sellers=Q.product_list;findVariationTotals(c.top_royalties,function(S){c.top_royalties=S.product_list;var R={update:"topSellerSummary",data:c};updateTabs(R)})})}else{if(b=="today"){if(showTestSales){d=test_sales_shirts[test_count];test_count++}}var t=0;var J=0;var K=0;var w=0;var D=0;var H=0;var C=[];var u={};Object.keys(d).forEach(function(Q){u=d[Q][us_marketplace_id][0];t+=parseInt(u.unitsSold);J+=parseInt(u.unitsCancelled);K+=parseInt(u.unitsReturned);w+=parseFloat(u.revenueValue);D+=parseFloat(u.royaltyValue);u.net_sold=u.unitsSold-u.unitsCancelled;C[H]=u;++H});w=w.toFixed(2);D=D.toFixed(2);c.total_sales=t;c.total_returned=K;c.total_cancelled=J;c.net_sales=t-J;c.total_revenue=w;c.total_royalties=D;c.product_list=C.sort(function(R,Q){return Q.net_sold-R.net_sold});findVariationTotals(c.product_list,function(Q){c.product_list=Q.product_list;c.variation_totals=Q.variation_totals});if(!g){var z={update:"salesSummary",data:c};updateTabs(z)}if(b=="today"){var N=moment().startOf("day").valueOf();var B;var v;var M;var G;var L;var I=[];var O;var P=logged_in_user+"_salesSummaryToday";chrome.storage.local.get(P,function(ae){if(typeof ae[P]!="undefined"&&ae[P]!=""){if(N>ae[P].lastUpdate){B=0;v=0;M=0;G=0;I=[]}else{B=ae[P].net_sales;v=ae[P].total_sales;M=ae[P].total_cancelled;G=ae[P].total_returned;I=ae[P].sales_list}}else{B=0;v=0;M=0;G=0;I=[]}v=c.total_sales-v;M=c.total_cancelled-M;G=c.total_returned-G;chrome.browserAction.setBadgeText({text:c.net_sales.toString()});L=0;u={};var S=0;var ac=[];var T=[];var ab=[];var U=false;var W=0;var X=0;if(v!=0||M!=0||G!=0){Object.keys(d).forEach(function(af){u=d[af][us_marketplace_id][0];S=u.unitsSold-u.unitsCancelled;if(S>0||u.unitsReturned>0){u.net_sold=S;u.royalties=parseFloat(u.royaltyValue).toFixed(2);U=false;for(y=0;y<I.length;++y){if(u.asin==I[y].asin){if(u.net_sold>I[y].net_sold){u.sold_order=c.net_sales;ab[X]=u;ab[X].net_just_sold=u.net_sold-I[y].net_sold;L+=ab[X].net_just_sold;++X}else{if(u.unitsReturned>I[y].unitsReturned){u.sold_order=c.net_sales}else{u.sold_order=I[y].sold_order}}U=true;y=I.length}}if(!U){u.sold_order=c.net_sales;if(u.net_sold>0){ab[X]=u;ab[X].net_just_sold=u.net_sold;L+=ab[X].net_just_sold;++X}}ac[W]=u;++W}});T=ac.sort(function(ag,af){return af.sold_order-ag.sold_order});O={lastUpdate:N,net_sales:c.net_sales,total_sales:c.total_sales,total_cancelled:c.total_cancelled,total_returned:c.total_returned,sales_list:T};if(logged_in_user){var aa={};aa[P]=O;chrome.storage.local.set(aa)}var V={data:c,result_container:"last-seven-days-chart"};var Z={update:"updateSalesChart",data:V};updateTabs(Z)}else{T=I}findVariationTotals(T,function(ag){var af={update:"todaysSalesList",data:ag.product_list};updateTabs(af)});if(L>0){var Y=["Good work","Great work","Congrats","Keep it up","Hooray","Awesome"];var ad=Math.floor(Math.random()*(5-0+1)+0);var Q="";for(x=0;x<ab.length;++x){Q+="âž¤ "+ab[x].net_just_sold+" x "+ab[x].asinName;if((ab.length-x)>1){Q+=" \n"}}if(opt_showSalesNotif){var R={type:"basic",title:"You sold "+(L>1?L:"a")+" shirt"+(L>1?"s":"")+". "+Y[ad]+"!",message:Q,contextMessage:"Powered by PrettyMerch",iconUrl:chrome.extension.getURL("/img/new_sale_1_small.png")};chrome.notifications.create(R,function(af){newSaleNotification=af;if(sales_sound){sales_sound.play()}})}}if(typeof r==="function"){r(L)}})}if(typeof r==="function"){r(c)}}}}}};setTimeout(function(){h.send()},j)}}function createDaysChart(g,f,c){if(loggedIn){var j=g;var b="."+f;var c=c||0;var e=moment().startOf("day");var a;var h;switch(j){case"last-seven-days":a=moment(e).subtract(8,"days");h=moment(e);break;default:break}getDailySales(a,h,b,c,function(d){var m={};m.result_container=f;m.chart_labels=d.datesData;m.chart_data_sales=d.netSoldData;m.chart_data_royalties=d.royaltiesData;var l={update:"createChart",data:m};updateTabs(l)})}}function getDailySales(h,e,v,D,l){if(loggedIn){var D=D||0;if(v){var q={toggleProgressBar:true,container:v,action:"show",title:"Downloading Sales..."};updateTabs(q)}var B=moment().startOf("day");var j=h.format("M/DD/YY")+" - "+e.format("M/DD/YY");var f=0;var m=0;var C=0;var E=0;var t=0;var b=0;var p=[];var u=[];var z=[];var g=[];var r=[];var s=[];var c=[];var o;var n=[];var A=0;var w=0;var a=Math.ceil(e.diff(h,"days",true));a=a-1;setTimeout(function(){var d=0;var I=0;for(k=a;k>=0;k--){o=a-k;A+=1;w+=1;(function(J){var L=a-J;var K=moment(e).subtract(k,"days");c[J]=K.format("YYYY-MM-DD");F(J,K,K)})(o)}function F(M,J,N){var L=Math.floor(Math.random()*(350-150+1)+150);var K="";n[M]=new XMLHttpRequest();K="https://merch.amazon.com/product-purchases-records?fromDate="+J.valueOf()+"&toDate="+N.valueOf();n[M].open("GET",K,true);n[M].onreadystatechange=function(){if(n[M].readyState==4){if(xml_success_responsees.indexOf(n[M].status)===-1){checkLogIn();return false}else{if(n[M].responseText.indexOf("AuthenticationPortal")!=-1){handleLogOut()}else{var Q=JSON.parse(n[M].responseText);var S=0;var V=0;var T=0;var U=0;var P=0;var O=0;var R={};Object.keys(Q).forEach(function(X){R=Q[X][us_marketplace_id][0];S+=parseInt(R.unitsSold);V+=parseInt(R.unitsCancelled);T+=parseInt(R.unitsReturned);P+=parseFloat(R.revenueValue);O+=parseFloat(R.royaltyValue)});U+=(S-V);f+=S;m+=V;C+=T;E+=U;t+=P;b+=O;p[M]=S;u[M]=V;z[M]=T;g[M]=U;r[M]=P;s[M]=O;A+=-1;if(v){var W={updateProgressBar:true,container:v,percentComplete:((w-A)/w)*100};updateTabs(W)}if(A==0){H()}}}}};setTimeout(function(){n[M].send()},d);d+=L}function H(){if(v){var K={toggleProgressBar:true,container:v,action:"hide",title:""};updateTabs(K)}var J={titleDate:j,totalSold:f,totalCancelled:m,totalReturned:C,totalNetSold:E,totalRevenue:t,totalRoyalties:b,soldData:p,cancelledData:u,returnedData:z,netSoldData:g,revenueData:r,royaltiesData:s,datesData:c};G(J)}function G(J){if(typeof l==="function"){l(J)}}},D)}}function getAllTimeSalesStats(c,a,b,d){b=b||0;a=a||false;getAllTimeSales(c,a,b,function(f){var e={net_sales:f.totalNetSold,total_cancelled:f.totalCancelled,total_returned:f.totalReturned,total_revenue:f.totalRevenue,total_royalties:f.totalRoyalties,total_sales:f.totalSold,product_list:f.combined_sales_listData.product_list,variation_totals:f.combined_sales_listData.variation_totals,result_container:a,title_date:"All Time"};if(typeof d==="function"){d(e)}})}function getAllTimeSalesSummary(c,b){b=b||0;var a=".sales-summary.all-time";getAllTimeSales(c,a,b,function(d){var e={update:"allTimeSalesSummary",data:d};updateTabs(e)})}function getAllTimeSales(h,g,b,l){b=b||0;var f=moment().startOf("day");var a=beginning_of_time.valueOf();var e=moment(f).subtract(3,"months").endOf("month").startOf("day").valueOf();var c=logged_in_user+"_beg_to_3mo_ago_"+a+"-"+e;chrome.storage.local.get(c,function(d){if(h&&typeof d[c]!="undefined"&&d[c]!=""){var n=jQuery.extend(true,{},d[c]);var m=moment(f).subtract(2,"months").startOf("month");getMonthlySales(m,f,h,g,b,function(o){n.titleDate=moment(beginning_of_time).format("M/D/YY")+" - "+moment(f).format("M/D/YY");n.totalSold+=o.totalSold;n.totalCancelled+=o.totalCancelled;n.totalReturned+=o.totalReturned;n.totalNetSold+=o.totalNetSold;n.totalRevenue+=o.totalRevenue;n.totalRoyalties+=o.totalRoyalties;var p=n.soldData.length;for(x=0;x<o.soldData.length;++x){n.soldData[p+x]=o.soldData[x];n.cancelledData[p+x]=o.cancelledData[x];n.returnedData[p+x]=o.returnedData[x];n.netSoldData[p+x]=o.netSoldData[x];n.revenueData[p+x]=o.revenueData[x];n.royaltiesData[p+x]=o.royaltiesData[x];n.datesData[p+x]=moment(o.datesData[x]).format("YYYY-MM-DD");n.sales_listData[p+x]=o.sales_listData[x]}j(n)})}else{getMonthlySales(beginning_of_time,f,h,g,b,function(o){j(o)})}});function j(d){if(typeof l==="function"){l(d)}}}function getMonthlySales(j,e,q,B,L,m){if(loggedIn){var L=L||0;if(B){var u={toggleProgressBar:true,container:B,action:"show",title:"Downloading Sales..."};updateTabs(u)}e=moment(e).endOf("month");var I=moment().startOf("day");var n=j.format("m/d/yy")+" - "+e.format("m/d/yy");var D=moment(j).startOf("month").valueOf();var J=moment(e).endOf("month").startOf("day").valueOf();var p=moment(beginning_of_time).valueOf();var M=moment(I).subtract(3,"months").endOf("month").startOf("day").valueOf();var g=false;var G=0;if(D==p&&J>M){G=Math.ceil(moment(M).diff(beginning_of_time,"months",true))}var f=0;var o=0;var K=0;var N=0;var z=0;var b=0;var t=[];var A=[];var F=[];var h=[];var v=[];var w=[];var c=[];var l=[];var C=[];var s;var r=[];var H=0;var E=0;var a=Math.ceil(e.diff(j,"months",true));a=a-1;setTimeout(function(){var d=0;var Q=0;for(k=a;k>=0;k--){s=a-k;H+=1;E+=1;(function(U){var W=a-U;var V=moment(e).subtract(k,"months");var T=moment(V).startOf("month");var X=moment(V).endOf("month").startOf("day");c[U]=T.format("YYYY-MM-DD");var S=logged_in_user+"_sales_"+T.valueOf()+"-"+X.valueOf();if(q&&W>2){chrome.storage.local.get(S,function(Y){if(typeof Y[S]!="undefined"&&Y[S]!=""){f+=Y[S].total_sold;o+=Y[S].total_cancelled;K+=Y[S].total_returned;N+=Y[S].total_net_sold;z+=Y[S].total_revenue;b+=Y[S].total_royalties;t[U]=Y[S].total_sold;A[U]=Y[S].total_cancelled;F[U]=Y[S].total_returned;h[U]=Y[S].total_net_sold;v[U]=Y[S].total_revenue;w[U]=Y[S].total_royalties;l[U]=Y[S].sales_list;combineSalesLists(C,l[U],function(aa){C=jQuery.extend(true,{},aa)});H+=-1;if(B){var Z={updateProgressBar:true,container:B,percentComplete:((E-H)/E)*100};updateTabs(Z)}if(H==0){P()}}else{R(U,T,X,S)}})}else{R(U,T,X,S)}})(s)}function R(W,T,X,S){var V=Math.floor(Math.random()*(350-150+1)+150);var U="";r[W]=new XMLHttpRequest();U="https://merch.amazon.com/product-purchases-records?fromDate="+T.valueOf()+"&toDate="+X.valueOf();r[W].open("GET",U,true);r[W].onreadystatechange=function(){if(r[W].readyState==4){if(xml_success_responsees.indexOf(r[W].status)===-1){checkLogIn();return false}else{if(r[W].responseText.indexOf("AuthenticationPortal")!=-1){handleLogOut()}else{var ad=JSON.parse(r[W].responseText);var aa=0;var ac=0;var ag=0;var Y=0;var ah=0;var af=0;var Z=[];var ab=0;var ae={};Object.keys(ad).forEach(function(ai){ae=ad[ai][us_marketplace_id][0];aa+=parseInt(ae.unitsSold);ac+=parseInt(ae.unitsCancelled);ag+=parseInt(ae.unitsReturned);ah+=parseFloat(ae.revenueValue);af+=parseFloat(ae.royaltyValue);ae.net_sold=ae.unitsSold-ae.unitsCancelled;Z[ab]=ae;++ab});Y+=(aa-ac);findVariationTotals(Z,function(aj){Z=aj;f+=aa;o+=ac;K+=ag;N+=Y;z+=ah;b+=af;t[W]=aa;A[W]=ac;F[W]=ag;h[W]=Y;v[W]=ah;w[W]=af;l[W]=Z;combineSalesLists(C,l[W],function(al){C=jQuery.extend(true,{},al)});H+=-1;if(B){var ak={updateProgressBar:true,container:B,percentComplete:((E-H)/E)*100};updateTabs(ak)}if(H==0){P()}currentMonthSales={total_sold:aa,total_cancelled:ac,total_returned:ag,total_net_sold:Y,total_revenue:ah,total_royalties:af,sales_list:Z};if(logged_in_user){var ai={};ai[S]=currentMonthSales;chrome.storage.local.set(ai)}})}}}};setTimeout(function(){r[W].send()},d);d+=V}function P(){if(g){var af=0;var T=0;var ad=0;var Z=0;var ac=0;var ak=0;var V=[];var X=[];var ag=[];var Y=[];var ai=[];var aj=[];var S=[];var ae=[];for(x=0;x<G;++x){af+=t[x];T+=A[x];ad+=F[x];Z+=h[x];ac+=v[x];ak+=w[x];V[x]=t[x];X[x]=A[x];ag[x]=F[x];Y[x]=h[x];ai[x]=v[x];aj[x]=w[x];ae[x]=c[x];S[x]=l[x]}var W={totalSold:af,totalCancelled:T,totalReturned:ad,totalNetSold:Z,totalRevenue:ac,totalRoyalties:ak,soldData:V,cancelledData:X,returnedData:ag,netSoldData:Y,revenueData:ai,royaltiesData:aj,datesData:ae,sales_listData:S};var ah=logged_in_user+"_beg_to_3mo_ago_"+p+"-"+M;if(logged_in_user){var ab={};ab[ah]=W;chrome.storage.local.set(ab)}}var U={titleDate:n,totalSold:f,totalCancelled:o,totalReturned:K,totalNetSold:N,totalRevenue:z,totalRoyalties:b,soldData:t,cancelledData:A,returnedData:F,netSoldData:h,revenueData:v,royaltiesData:w,datesData:c,sales_listData:l,combined_sales_listData:C};if(B){var aa={toggleProgressBar:true,container:B,action:"hide",title:""};updateTabs(aa)}O(U)}function O(S){if(typeof m==="function"){m(S)}}},L)}}function findVariationTotals(h,d){var m={};var a={};var t=0;m.product_list=[];m.variation_totals={};m.variation_totals.fitType=[];m.variation_totals.color=[];m.variation_totals.size=[];m.variation_totals.productType=[];var p={};var r={};var n={};var g={};for(x=0;x<h.length;++x){a=jQuery.extend(true,{},h[x]);a.variation_totals={};a.variation_totals.fitType=[];a.variation_totals.color=[];a.variation_totals.size=[];a.variation_totals.productType=[];var b={};var s={};var o={};var l={};if(a.net_sold>0||a.unitsReturned>0){if(a.productType.toLowerCase()=="popsockets"){l.popsockets=a.net_sold;g.popsockets=(g.popsockets?g.popsockets:0)+a.net_sold}else{for(i=0;i<a.variationRecords.length;i++){var q=a.variationRecords[i].unitsSold-a.variationRecords[i].unitsCancelled;if(q>0){var c=a.variationRecords[i].variationInfo[0].replace(/\s+/g,"_").toLowerCase();b[c]=(b[c]?b[c]:0)+q;p[c]=(p[c]?p[c]:0)+q;var e=a.variationRecords[i].variationInfo[2].replace(/\s+/g,"_").toLowerCase();s[e]=(s[e]?s[e]:0)+q;n[e]=(n[e]?n[e]:0)+q;var f=a.variationRecords[i].variationInfo[1].replace(/\s+/g,"_").toLowerCase();o[f]=(o[f]?o[f]:0)+q;r[f]=(r[f]?r[f]:0)+q;var u=a.variationRecords[i].productType.replace(/\s+/g,"_").toLowerCase();l[u]=(l[u]?l[u]:0)+q;g[u]=(g[u]?g[u]:0)+q}}}Object.keys(b).forEach(function(j){a.variation_totals.fitType.push({variation:j,total:b[j]})});Object.keys(s).forEach(function(j){a.variation_totals.color.push({variation:j,total:s[j]})});Object.keys(o).forEach(function(j){a.variation_totals.size.push({variation:j,total:o[j]})});Object.keys(l).forEach(function(j){a.variation_totals.productType.push({variation:j,total:l[j]})});delete a.variationRecords;m.product_list[t]=jQuery.extend(true,{},a);++t}}Object.keys(p).forEach(function(j){m.variation_totals.fitType.push({variation:j,total:p[j]})});Object.keys(n).forEach(function(j){m.variation_totals.color.push({variation:j,total:n[j]})});Object.keys(r).forEach(function(j){m.variation_totals.size.push({variation:j,total:r[j]})});Object.keys(g).forEach(function(j){m.variation_totals.productType.push({variation:j,total:g[j]})});if(typeof d==="function"){d(m)}}function combineSalesLists(d,e,m){var h=0;var g=0;var j=0;var f=0;var c=false;var l=false;if(e.product_list&&e.product_list.length){if(d.product_list&&d.product_list.length){for(h=0;h<e.product_list.length;++h){c=false;for(g=0;g<d.product_list.length;++g){if(e.product_list[h].asin==d.product_list[g].asin){d.product_list[g].net_sold+=e.product_list[h].net_sold;d.product_list[g].unitsSold+=e.product_list[h].unitsSold;d.product_list[g].unitsCancelled+=e.product_list[h].unitsCancelled;d.product_list[g].unitsReturned+=e.product_list[h].unitsReturned;d.product_list[g].revenueValue=(parseFloat(d.product_list[g].revenueValue)+parseFloat(e.product_list[h].revenueValue)).toFixed(2);d.product_list[g].royaltyValue=(parseFloat(d.product_list[g].royaltyValue)+parseFloat(e.product_list[h].royaltyValue)).toFixed(2);Object.keys(e.product_list[h].variation_totals).forEach(function(a){for(j=0;j<e.product_list[h].variation_totals[a].length;++j){l=false;for(f=0;f<d.product_list[g].variation_totals[a].length;++f){if(e.product_list[h].variation_totals[a][j].variation==d.product_list[g].variation_totals[a][f].variation){d.product_list[g].variation_totals[a][f].total+=e.product_list[h].variation_totals[a][j].total;l=true;f=d.product_list[g].variation_totals[a].length}}if(!l){d.product_list[g].variation_totals[a].push(e.product_list[h].variation_totals[a][j])}}});c=true;g=d.product_list.length}}if(!c){d.product_list.push(e.product_list[h])}}Object.keys(e.variation_totals).forEach(function(a){for(j=0;j<e.variation_totals[a].length;++j){l=false;for(f=0;f<d.variation_totals[a].length;++f){if(e.variation_totals[a][j].variation==d.variation_totals[a][f].variation){d.variation_totals[a][f].total+=e.variation_totals[a][j].total;l=true;f=d.variation_totals[a].length}}if(!l){d.variation_totals[a].push(e.variation_totals[a][j])}}})}else{d=jQuery.extend(true,{},e)}}if(typeof m==="function"){m(d)}}function findOpenTabs(a){chrome.tabs.query({url:"https://merch.amazon.com/dashboard*"},function(d){var c=[];for(var b=0;b<d.length;++b){var e=d[b].url;if(e.indexOf("oldDash")==-1){c.push(d[b])}}if(typeof a==="function"){a(c)}})}function updateTabs(a){findOpenTabs(function(c){for(var b=0;b<c.length;++b){chrome.tabs.sendMessage(c[b].id,a,function(d){})}})}function setBrowserIcons(b){if(b=="active"){chrome.browserAction.setTitle({title:"PrettyMerch"});var a={"16":chrome.extension.getURL("/icons/icon16.png"),"24":chrome.extension.getURL("/icons/icon24.png"),"32":chrome.extension.getURL("/icons/icon32.png")};chrome.browserAction.setIcon({path:a});chrome.browserAction.setBadgeBackgroundColor({color:"#1a63a4"});if(loggedOutNotification){chrome.notifications.clear(loggedOutNotification);loggedOutNotification=false}}else{chrome.browserAction.setTitle({title:"PrettyMerch\nYou are logged out"});var a={"16":chrome.extension.getURL("/icons/icon16-bw.png"),"24":chrome.extension.getURL("/icons/icon24-bw.png"),"32":chrome.extension.getURL("/icons/icon32-bw.png")};chrome.browserAction.setIcon({path:a});chrome.browserAction.setBadgeBackgroundColor({color:"#e3a002"})}}function checkAlarms(){chrome.alarms.get("fetchNewSales",function(b){if(b){var a=moment().valueOf();if(b.scheduledTime<=a){resetAlarms(function(c){fetchNewSales()})}else{}}else{resetAlarms(function(c){fetchNewSales()})}})}function resetAlarms(a){chrome.alarms.clearAll(function(b){chrome.alarms.create("fetchNewSales",alarmOpts);chrome.alarms.create("doMiscTasks",{delayInMinutes:5,periodInMinutes:5});if(typeof a==="function"){a()}})}function onAlarm(a){if(a){if(a.name=="fetchNewSales"){fetchNewSales()}else{if(a.name=="doMiscTasks"){doMiscTasks()}else{if(a.name=="doCheckLoginFallback"){doCheckLoginFallback()}else{}}}}}function fetchNewSales(){waitForinitMain(function(){getSalesSummary("today",0,0,".sales-summary.today",0,false,function(a){if(a>0){findOpenTabs(function(b){if(b.length>0){getSalesSummary("last-seven-days",0,0,".sales-summary.last-seven-days",200);getSalesSummary("this-month",0,0,".sales-summary.this-month",500)}})}});findOpenTabs(function(a){if(a.length>0){getPublishedItemsSummary();getProcessingItems()}})})}function initPrettyDash(a){resetAlarms(function(b){getPublishedItemsSummary();getProcessingItems();getSalesSummary("today",0,0,".sales-summary.today",10);getSalesSummary("yesterday",0,0,".sales-summary.yesterday",150);getSalesSummary("last-seven-days",0,0,".sales-summary.last-seven-days",300);getSalesSummary("this-month",0,0,".sales-summary.this-month",450);getSalesSummary("previous-month",0,0,".sales-summary.previous-month",500);createDaysChart("last-seven-days","last-seven-days-chart",650);getSalesSummary("top-sellers",0,0,".top-sellers",4000);getAllTimeSalesSummary(true,2000);doMiscTasks(5000)})}function initCommon(c){loggedIn=true;G_AUTOLOGIN_TAB=false;G_ATTEMPT_AUTO_RE_LOGIN=true;G_COUNT_LOGIN_ATTEMPTS=0;G_ARL_LOGGED_OUT_MSG="";var b=logged_in_user+btoa("_licence");chrome.storage.sync.get(b,function(f){if(typeof f[b]!="undefined"){var g=atob(f[b].ul);var e=atob(f[b].iv);var d=atob(f[b].lm);G_IS_PRO=(e==="true"?true:false)}else{G_IS_PRO=false}a()});function a(){if(typeof c==="function"){c()}}}chrome.extension.onMessage.addListener(function(c,b,a){if(c.initApp=="prettyDash"){setBrowserIcons("active");waitForinitMain(function(){initCommon();initPrettyDash(b.tab.id)})}if(c.initApp=="otherPage"){setBrowserIcons("active");waitForinitMain(function(){initCommon();checkAlarms()})}if(c.loaded_auto_re_login){a({msg:"Ok"});doAutoReLogin(b.tab.id);return true}if(c.show_in_bg_log){}if(c.refresh_all_time_no_cache){getAllTimeSalesSummary(false,0)}if(c.get_all_time_sales){getAllTimeSales(true,c.progress_container,0,function(d){a(d)});return true}if(c.get_sales_summary){if(c.period=="all-time"){getAllTimeSalesStats(true,c.target_container,0,function(d){a(d)})}else{getSalesSummary(c.period,c.startDate,c.endDate,c.target_container,0,true,function(d){a(d)})}return true}if(c.manual_check_for_sales){fetchNewSales()}if(c.trigger_do_misc_tasks){doMiscTasks()}if(c.manual_check_for_tier_up){getPublishedItemsSummary()}if(c.trigger_auto_login){triggerAutoReLogin()}if(c.user_logged_in){handleLogIn(c.s_id)}if(c.get_logged_in_user){a(logged_in_user)}if(c.user_logged_out){waitForinitMain(function(){showLogoutNotification=false;G_ATTEMPT_AUTO_RE_LOGIN=false;checkLogIn()})}if(c.saveOptions){saveOptions(c.options,function(d){});a({test:true})}if(c.update_extension_now){chrome.runtime.reload()}});chrome.alarms.onAlarm.addListener(onAlarm);chrome.notifications.onClicked.addListener(function(a){if(a=welcomeNotification){chrome.tabs.create({url:"https://merch.amazon.com/dashboard"});chrome.notifications.clear(welcomeNotification);welcomeNotification=false}if(a=loggedOutNotification){chrome.windows.getAll(function(b){if(b.length>0){chrome.tabs.create({url:"https://merch.amazon.com/dashboard"})}else{chrome.windows.create({url:"https://merch.amazon.com/dashboard"})}});chrome.notifications.clear(loggedOutNotification);loggedOutNotification=false}if(a=newSaleNotification){chrome.windows.getAll(function(b){if(b.length>0){chrome.tabs.create({url:"https://merch.amazon.com/dashboard"})}else{chrome.windows.create({url:"https://merch.amazon.com/dashboard"})}});chrome.notifications.clear(newSaleNotification);newSaleNotification=false}});chrome.notifications.onButtonClicked.addListener(function(b,a){if(b===loggedOutNotification){if(a===0){chrome.windows.getAll(function(c){if(c.length>0){chrome.tabs.create({url:"https://merch.amazon.com/dashboard"})}else{chrome.windows.create({url:"https://merch.amazon.com/dashboard"})}});chrome.notifications.clear(loggedOutNotification);loggedOutNotification=false}else{if(a===1){chrome.notifications.clear(loggedOutNotification);loggedOutNotification=false}}}});chrome.notifications.onClosed.addListener(function(b,a){if(b=welcomeNotification){welcomeNotification=false}if(b=loggedOutNotification){loggedOutNotification=false}if(b=newSaleNotification){newSaleNotification=false}});chrome.runtime.onInstalled.addListener(function(a){waitForinitMain(function(){if(a.reason=="install"){G_ATTEMPT_AUTO_RE_LOGIN=false;forceLogout(function(){var b={type:"image",isClickable:true,requireInteraction:true,title:"You just installed PrettyMerch",message:"Click here to go to your new and improved Merch Dashboard",iconUrl:chrome.extension.getURL("/img/notificationLogo.png"),imageUrl:chrome.extension.getURL("/img/notification-welcome-min.png")};chrome.notifications.create(b,function(d){welcomeNotification=d;fetchNewSales()});var c={show_welcome_message:true,title:"Hello. Welcome to PrettyMerch!",message:"<p>Congratulations, you just gave your Merch dashboard a major upgrade!</p><p>Now you can get a quick view of your sales and a summary of everything that is important in a beautiful way. You don't have to refresh this page; It updates as you sell and notifies you of new sales immediately.</p>"};chrome.storage.sync.set({welcomeMessage:c},function(){})})}if(a.reason=="update"){G_ATTEMPT_AUTO_RE_LOGIN=false;resetAlarms(function(b){forceLogout(function(){var d=chrome.runtime.getManifest();var c={show_update:true,version:d.version,title:"PrettyMerch has been updated to v"+d.version,message:"<b>You're now rocking our newest and best version ever</b><br/><br/>Here's what has changed:",free_list:[],pro_list:["NEW: You can now see your <b>All Time Best Sellers</b> and <b>Analytics for your All Time sales</b>. Just click on the View Sales icon on the All Time sales widget"]};chrome.storage.local.clear(function(){});chrome.storage.sync.set({updateMessage:c},function(){});chrome.storage.sync.remove("updateAvailableMessage")})})}})});chrome.runtime.onStartup.addListener(function(a){waitForinitMain(function(){showLogoutNotification=false;G_ATTEMPT_AUTO_RE_LOGIN=false;resetAlarms(function(b){fetchNewSales()})})});chrome.browserAction.onClicked.addListener(function(a){chrome.tabs.query({url:"https://merch.amazon.com/dashboard*"},function(b){if(b.length){chrome.tabs.update(b[0].id,{active:true},function(c){})}else{chrome.tabs.create({url:"https://merch.amazon.com/dashboard"})}})});function doAutoReLogin(a){chrome.storage.local.get("arl_data",function(b){if(typeof b.arl_data!="undefined"&&b.arl_data!=""){G_AUTOLOGIN_TAB=b.arl_data.arl_tab_id}if(a==G_AUTOLOGIN_TAB){if(G_COUNT_LOGIN_ATTEMPTS>0){chrome.tabs.onUpdated.removeListener(autoReLoginListener);chrome.tabs.remove(G_AUTOLOGIN_TAB);G_ATTEMPT_AUTO_RE_LOGIN=false;handleLogOut()}else{chrome.tabs.sendMessage(G_AUTOLOGIN_TAB,{attempt_auto_login:"true",email:OPT_AUTO_RE_LOGIN_EMAIL,password:OPT_AUTO_RE_LOGIN_PASSWORD})}}else{}})}function autoReLoginListener(a,c,b){chrome.storage.local.get("arl_data",function(d){if(typeof d.arl_data!="undefined"&&d.arl_data!=""){G_AUTOLOGIN_TAB=d.arl_data.arl_tab_id}if(b.id==G_AUTOLOGIN_TAB){if(b.url.indexOf("merch.amazon.com")==-1&&b.url.indexOf("signin")!=-1&&c.status=="loading"){G_ATTEMPT_AUTO_RE_LOGIN=false;G_ARL_LOGGED_OUT_MSG="Auto Re-Login couldn't log you back in. Please make sure that the Password you entered in the Auto Re-Login Options is correct";chrome.tabs.onUpdated.removeListener(autoReLoginListener);chrome.tabs.remove(G_AUTOLOGIN_TAB);handleLogOut()}if(b.url.indexOf("merch.amazon.com")!=-1&&!(b.url.indexOf("signin")>-1)&&b.url.indexOf("dashboard")!=-1&&c.status=="loading"){G_ATTEMPT_AUTO_RE_LOGIN=false;chrome.tabs.onUpdated.removeListener(autoReLoginListener);chrome.tabs.remove(G_AUTOLOGIN_TAB);checkLogIn(function(e){if(e){G_AUTOLOGIN_TAB=false;G_ATTEMPT_AUTO_RE_LOGIN=true;G_COUNT_LOGIN_ATTEMPTS=0;resetAlarms(function(f){fetchNewSales()})}})}}else{}})};